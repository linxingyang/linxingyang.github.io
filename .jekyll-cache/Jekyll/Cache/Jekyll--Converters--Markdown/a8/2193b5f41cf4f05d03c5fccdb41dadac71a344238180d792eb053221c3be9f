I"#‹<h1 id="cmake">CMake</h1>

<p>æ¥ç€ä¸Šä¸€ç¯‡ï¼Œè¿™ç¯‡ä»‹ç»ä¾èµ–åº“ï¼Œåœ¨ä»‹ç»ä¾èµ–åº“ä¹‹å‰ï¼Œå…ˆçœ‹çœ‹å¦‚ä½•æ·»åŠ æºä»£ç å­ç›®å½•ã€‚</p>

<h2 id="æ·»åŠ æºä»£ç å­ç›®å½•">æ·»åŠ æºä»£ç å­ç›®å½•</h2>

<p>å½“å‰æ‰€åœ¨ä½ç½®</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test04# pwd
/tmp/c/2019-09-12-cmaketest/test04
</code></pre></div></div>

<p>å½“å‰ç›®å½•ä¸­çš„æ–‡ä»¶/æ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬æ–°å»ºäº†ä¸€ä¸ªsrcç›®å½•å¹¶å°†helloworld.cppæ”¾åœ¨å…¶ä¸­</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test04# tree
.
â”œâ”€â”€ build
â”œâ”€â”€ CMakeLists.txt
â””â”€â”€ src
    â”œâ”€â”€ CMakeLists.txt
    â””â”€â”€ helloworld.cpp
</code></pre></div></div>

<p><code class="highlighter-rouge">test04/build</code>æ˜¯ç”¨æ¥å­˜æ”¾ä¸­é—´æ–‡ä»¶çš„ç©ºæ–‡ä»¶å¤¹ï¼Œ<code class="highlighter-rouge">test04/CMakeLists.txt</code>æ˜¯é¡¹ç›®çš„é…ç½®æ–‡ä»¶ï¼Œ<code class="highlighter-rouge">test04/src/CMakeLists.txt</code>æ˜¯srcæ–‡ä»¶å¤¹çš„é…ç½®æ–‡ä»¶ï¼Œ<code class="highlighter-rouge">test04/src/helloworld.cpp</code>åˆ™è¿˜æ˜¯é‚£ä¸ªåªæ‰“å°ä¸€å¥helloworldçš„ç¨‹åºã€‚</p>

<p><code class="highlighter-rouge">test04/CMakeLists.txt</code>çš„å†…å®¹</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test04# vi CMakeLists.txt 
CMAKE_MINIMUM_REQUIRED (VERSION 2.6)
PROJECT (HELLOWORLD)
MESSAGE (STATUS "this is BINARY dir " ${HELLOWORLD_BINARY_DIR})
MESSAGE (STATUS "this is SOURCE dir " ${HELLOWORLD_SOURCE_DIR})
# ADD_EXECUTABLE (helloworld helloworld.cpp)

ADD_SUBDIRECTORY (src)
</code></pre></div></div>

<p><code class="highlighter-rouge">test04/src/CMakeLists.txt</code>çš„å†…å®¹</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test04# vi src/CMakeLists.txt 
ADD_EXECUTABLE (helloworld helloworld.cpp)
SET (EXECUTABLE_OUTPUT_PATH ${PROJECT_BINARY_DIR}/bin)
</code></pre></div></div>

<p><code class="highlighter-rouge">test04/src/helloworld.cpp</code>ä¸­çš„å†…å®¹</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test04# cat src/helloworld.cpp 
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

int main(int argc, char * args[]) {
  printf("hello world\n");
}
</code></pre></div></div>

<p>è¿›å…¥åˆ°buildç›®å½•è¿›è¡Œç¼–è¯‘</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test04# cd build

test04/build# cmake ..
-- The C compiler identification is GNU 5.4.0
-- The CXX compiler identification is GNU 5.4.0
-- Check for working C compiler: /usr/bin/cc
-- Check for working C compiler: /usr/bin/cc -- works
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - done
-- Detecting C compile features
-- Detecting C compile features - done
-- Check for working CXX compiler: /usr/bin/c++
-- Check for working CXX compiler: /usr/bin/c++ -- works
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - done
-- Detecting CXX compile features
-- Detecting CXX compile features - done
-- this is BINARY dir /tmp/c/2019-09-12-cmaketest/test04/build
-- this is SOURCE dir /tmp/c/2019-09-12-cmaketest/test04
-- Configuring done
-- Generating done
-- Build files have been written to: /tmp/c/2019-09-12-cmaketest/test04/build

build# make
Scanning dependencies of target helloworld
[ 50%] Building CXX object src/CMakeFiles/helloworld.dir/helloworld.cpp.o
[100%] Linking CXX executable ../bin/helloworld
[100%] Built target helloworld
</code></pre></div></div>

<p>è¿è¡Œå¯æ‰§è¡Œç¨‹åºï¼Œæ³¨æ„å½“å‰å¯æ‰§è¡Œç¨‹åºè·¯å¾„ä¸º<code class="highlighter-rouge">test04/build/bin/helloworld</code></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test04/build# ./bin/helloworld 
hello world
</code></pre></div></div>

<p>çœ‹çœ‹å½“å‰çš„ç›®å½•ç»“æ„ï¼Œhelloworldçš„æ‰€åœ¨ä½ç½®</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test04/build# cd ..

test04# tree -F -L 3 -I CMakeFiles
.
â”œâ”€â”€ build/
â”‚Â Â  â”œâ”€â”€ bin/
â”‚Â Â  â”‚Â Â  â””â”€â”€ helloworld*
â”‚Â Â  â”œâ”€â”€ CMakeCache.txt
â”‚Â Â  â”œâ”€â”€ cmake_install.cmake
â”‚Â Â  â”œâ”€â”€ Makefile
â”‚Â Â  â””â”€â”€ src/
â”‚Â Â      â”œâ”€â”€ CMakeFiles/
â”‚Â Â      â”œâ”€â”€ cmake_install.cmake
â”‚Â Â      â””â”€â”€ Makefile
â”œâ”€â”€ CMakeLists.txt
â””â”€â”€ src/
    â”œâ”€â”€ CMakeLists.txt
    â””â”€â”€ helloworld.cpp
</code></pre></div></div>

<h3 id="é…ç½®æ–‡ä»¶test04cmakeliststxt">é…ç½®æ–‡ä»¶<code class="highlighter-rouge">test04/CMakeLists.txt</code></h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CMAKE_MINIMUM_REQUIRED (VERSION 2.6)
PROJECT (HELLOWORLD)
MESSAGE (STATUS "this is BINARY dir " ${HELLOWORLD_BINARY_DIR})
MESSAGE (STATUS "this is SOURCE dir " ${HELLOWORLD_SOURCE_DIR})
# ADD_EXECUTABLE (helloworld helloworld.cpp)

ADD_SUBDIRECTORY (src)
</code></pre></div></div>

<p>åœ¨è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­ï¼Œå°†ADD_EXECUTABLEæ³¨é‡Šæ‰äº†ï¼Œå› ä¸ºå½“å‰test04ç›®å½•ä¸‹æ˜¯æ²¡æœ‰hellworld.cppæ–‡ä»¶çš„ï¼Œè¿™ä¸ªæ–‡ä»¶å·²ç»ç§»åŠ¨åˆ°<code class="highlighter-rouge">test04/src</code>ç›®å½•ä¸­äº†ã€‚</p>

<h4 id="add_subdirectory-æ·»åŠ å­˜æ”¾æºæ–‡ä»¶çš„å­ç›®å½•">add_subdirectory æ·»åŠ å­˜æ”¾æºæ–‡ä»¶çš„å­ç›®å½•</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ADD_SUBDIRECTORY(source_dir [binary_dir] [EXCLUDE_FROM_ALL]) 
</code></pre></div></div>

<p>è¿™ä¸ªæŒ‡ä»¤ç”¨äº</p>
<ul>
  <li>source_dir å‘å½“å‰å·¥ç¨‹æ·»åŠ å­˜æ”¾æºæ–‡ä»¶çš„å­ç›®å½•ï¼Œ</li>
  <li>binary_dir å¹¶å¯ä»¥æŒ‡å®šä¸­é—´äºŒè¿›åˆ¶å’Œç›®æ ‡äºŒè¿›åˆ¶å­˜æ”¾çš„ä½ç½®ã€‚</li>
  <li>EXCLUDE_FROM_ALL å‚æ•°çš„å«ä¹‰æ˜¯å°†è¿™ä¸ªç›®å½•ä»ç¼–è¯‘è¿‡ç¨‹ä¸­æ’é™¤ï¼Œæ¯”å¦‚ï¼Œå·¥ç¨‹çš„ exampleï¼Œå¯èƒ½å°±éœ€è¦å·¥ç¨‹æ„å»ºå®Œæˆåï¼Œå†è¿›å…¥ example ç›®å½•å•ç‹¬è¿›è¡Œæ„å»º(å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡å®šä¹‰ä¾èµ–æ¥è§£å†³æ­¤ç±»é—®é¢˜)ã€‚</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ADD_SUBDIRECTORY (src bin)
</code></pre></div></div>
<p>ä¸Šé¢çš„ä¾‹å­å®šä¹‰äº†å°† src å­ç›®å½•åŠ å…¥å·¥ç¨‹ï¼Œå¹¶æŒ‡å®šç¼–è¯‘è¾“å‡º(åŒ…å«ç¼–è¯‘ä¸­é—´ç»“æœ)è·¯å¾„ä¸º bin ç›®å½•ã€‚å¦‚æœä¸è¿›è¡Œ bin ç›®å½•çš„æŒ‡å®šï¼Œé‚£ä¹ˆç¼–è¯‘ç»“æœ(åŒ…æ‹¬ä¸­é—´ç»“æœ)éƒ½å°†å­˜æ”¾åœ¨ <code class="highlighter-rouge">src</code> ç›®å½•ä¸‹ï¼ŒæŒ‡å®š bin ç›®å½•åï¼Œç›¸å½“äºåœ¨ç¼–è¯‘æ—¶ å°† src é‡å‘½åä¸º binï¼Œæ‰€æœ‰çš„ä¸­é—´ç»“æœå’Œç›®æ ‡äºŒè¿›åˆ¶éƒ½å°†å­˜æ”¾åœ¨ <code class="highlighter-rouge">bin</code> ç›®å½•ã€‚</p>

<p>æ­¤ä¾‹ä½¿ç”¨åˆ°äº†<code class="highlighter-rouge">ADD_SUBDIRECTORY (src)</code>è¡¨ç¤ºå°†å‘å½“å‰å·¥ç¨‹æ·»åŠ srcç›®å½•ä½œä¸ºå­˜æ”¾æºæ–‡ä»¶çš„å­ç›®å½•</p>

<p>è‡³äºä¸ºä»€ä¹ˆcmakeè¦ä½¿ç”¨è¿™ç§æ¯ä¸ªæºæ–‡ä»¶çš„ç›®å½•éƒ½éœ€è¦æ”¾ä¸€ä¸ªCMakeLists.txtæ–‡ä»¶ï¼Œè€Œä¸æ˜¯å¦‚mavenä¸€æ ·ï¼Œåªéœ€è¦ä¸€ä¸ªpom.xmlæ–‡ä»¶ï¼Œæš‚æœªæ·±ç©¶ã€‚æ˜¯ä¸æ˜¯å› ä¸ºC/C++é¡¹ç›®ä¸­çš„ä¸œè¥¿å¤ªæ‚äº†ï¼Œä¸å¥½å¼„ã€‚ã€‚ã€‚</p>

<h3 id="é…ç½®æ–‡ä»¶test04srccmakeliststxt">é…ç½®æ–‡ä»¶<code class="highlighter-rouge">test04/src/CMakeLists.txt</code></h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test04# vi src/CMakeLists.txt 
ADD_EXECUTABLE (helloworld helloworld.cpp)
SET (EXECUTABLE_OUTPUT_PATH ${PROJECT_BINARY_DIR}/bin)
</code></pre></div></div>
<p>ç”±äºhelloworld.cppåœ¨è¯¥ç›®å½•ä¸‹ï¼Œæ‰€ä»¥ç†æ‰€å½“ç„¶æ˜¯è¿™ä¸ªé…ç½®æ–‡ä»¶æŒ‡å®šå¯æ‰§è¡Œç¨‹åº<code class="highlighter-rouge">ADD_EXECUTABLE (helloworld helloworld.cpp)</code></p>

<p>æ¥ç€æœ‰ä¸¤ä¸ªæ–°ä¸œè¥¿ï¼ŒSET å’Œ EXECUTABLE_OUTPUT_PATH</p>

<h4 id="set-è®¾ç½®å˜é‡">set è®¾ç½®å˜é‡</h4>

<p>SET(VAR [VALUE] [CACHE TYPE DOCSTRING [FORCE]])</p>

<p>SET æŒ‡ä»¤å¯ä»¥ç”¨æ¥æ˜¾å¼çš„å®šä¹‰å˜é‡ã€‚</p>

<h4 id="executable_output_path-å¯æ‰§è¡Œç¨‹åºçš„è¾“å‡ºè·¯å¾„">EXECUTABLE_OUTPUT_PATH å¯æ‰§è¡Œç¨‹åºçš„è¾“å‡ºè·¯å¾„</h4>

<p>è¿™ä¸ªç”¨æ¥æŒ‡å®šå¯æ‰§è¡Œæ–‡ä»¶çš„è¾“å‡ºç›®å½•ï¼Œè¿™ä¸ªä¾‹å­æŒ‡å®šåœ¨ç¼–è¯‘ç›®å½•çš„binç›®å½•ä¸‹</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SET(EXECUTABLE_OUTPUT_PATH ${PROJECT_BINARY_DIR}/bin)
</code></pre></div></div>

<p>æ‰€ä»¥æœ€åå¯æ‰§è¡Œç¨‹åºhelloworldçš„è·¯å¾„ä¸º<code class="highlighter-rouge">test04/build/bin/helloworld</code></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test04# ll build/bin/helloworld 
-rwxr-xr-x 1 root root 8.5K Oct 27 14:56 build/bin/helloworld*
</code></pre></div></div>

<h2 id="åˆ›å»ºä¾èµ–åº“">åˆ›å»ºä¾èµ–åº“</h2>

<p>å¥½äº†æ¥ç€æ¥çœ‹çœ‹åœ¨CMakeä¸­ä½¿ç”¨ä¾èµ–åº“çš„ä¾‹å­ã€‚</p>

<p>å½“å‰ç›®å½•</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test05# pwd
/tmp/c/2019-09-12-cmaketest/test05
</code></pre></div></div>

<p>å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶/æ–‡ä»¶å¤¹ã€‚æˆ‘ä»¬å°†helloworld.cppæ”¾åˆ°äº†<code class="highlighter-rouge">test05/src/main</code>ä¸­ï¼Œåˆæ–°å»ºäº†ä¸€ä¸ª<code class="highlighter-rouge">test05/src/math</code>ä½œä¸ºä¸€ä¸ªåº“ã€‚</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test05# tree -F
.
â”œâ”€â”€ build/
â”œâ”€â”€ CMakeLists.txt
â””â”€â”€ src/
    â”œâ”€â”€ CMakeLists.txt
    â”œâ”€â”€ main/
    â”‚Â Â  â”œâ”€â”€ CMakeLists.txt
    â”‚Â Â  â””â”€â”€ helloworld.cpp
    â””â”€â”€ math/
        â”œâ”€â”€ CMakeLists.txt
        â”œâ”€â”€ math.cpp
        â””â”€â”€ math.h

4 directories, 7 files
</code></pre></div></div>

<p>æ¥ç€æ¥çœ‹çœ‹å„ä¸ªæ–‡ä»¶çš„å†…å®¹</p>

<p><code class="highlighter-rouge">test05/CMakeLists.txt</code>çš„å†…å®¹</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test05# cat CMakeLists.txt 
CMAKE_MINIMUM_REQUIRED (VERSION 2.6)
PROJECT (HELLOWORLD)
MESSAGE (STATUS "this is BINARY dir " ${HELLOWORLD_BINARY_DIR})
MESSAGE (STATUS "this is SOURCE dir " ${HELLOWORLD_SOURCE_DIR})
ADD_SUBDIRECTORY (src)
</code></pre></div></div>

<p><code class="highlighter-rouge">test05/src/CMakeLists.txt</code>çš„å†…å®¹ï¼Œå…¶ä¸­å°±æ˜¯æ·»åŠ äº†ä¸¤ä¸ªå­ç›®å½•</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test05# cat src/CMakeLists.txt 
ADD_SUBDIRECTORY (main)
ADD_SUBDIRECTORY (math)
</code></pre></div></div>

<p><code class="highlighter-rouge">test05/src/main/CMakeLists.txt</code>çš„å†…å®¹ï¼ŒæŒ‡å®šç”Ÿæˆå¯æ‰§è¡Œç¨‹åºï¼Œè®¾ç½®äº†å¯æ‰§è¡Œç¨‹åºå­˜æ”¾çš„ç›®å½•ï¼Œè¿˜æœ‰è®¾ç½®é“¾æ¥åº“ã€‚è¿™äº›ç¨åè§£é‡Šã€‚</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test05# cat src/main/CMakeLists.txt 
ADD_EXECUTABLE (helloworld helloworld.cpp)
SET (EXECUTABLE_OUTPUT_PATH ${PROJECT_BINARY_DIR}/bin)
TARGET_LINK_LIBRARIES (helloworld math)
</code></pre></div></div>

<p><code class="highlighter-rouge">test05/src/main/helloworld.cpp</code>çš„å†…å®¹ï¼Œåšäº†ä¿®æ”¹ï¼Œä½¿ç”¨äº†mathåº“ï¼Œæ³¨æ„å…¶ä¸­å¼•ç”¨math.hçš„æ–¹å¼æ˜¯ä½¿ç”¨ç›¸å¯¹è·¯å¾„çš„â€“<code class="highlighter-rouge">#include "../math/math.h"</code></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test05# cat src/main/helloworld.cpp 
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include "../math/math.h"

int main(int argc, char * args[]) {
  printf("hello world\n");
  int n1 = 5;
  int n2 = 10;
  int nRet = add(5, 10);
  printf("%d + %d = %d\n", n1, n2, nRet);
}
</code></pre></div></div>

<p><code class="highlighter-rouge">test05/src/math/CMakeLists.txt</code>çš„å†…å®¹ï¼Œæ·»åŠ äº†ä¸€ä¸ªåº“ï¼Œå¹¶æŒ‡å®šç”Ÿæˆè¿™ä¸ªåº“çš„è·¯å¾„ã€‚</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test05# cat src/math/CMakeLists.txt 
ADD_LIBRARY (math math.cpp)
SET (LIBRARY_OUTPUT_PATH ${PROJECT_BINARY_DIR}/lib)
</code></pre></div></div>

<p><code class="highlighter-rouge">test05/src/math/math.h</code>çš„å†…å®¹ï¼Œè¿™ä¸ªåº“æ¯”è¾ƒç®€å•ï¼Œå°±å®šä¹‰äº†ä¸€ä¸ªæ–¹æ³•addã€‚</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test05# cat src/math/math.h 
#ifndef MATH_H__20191027
#define MATH_H__20191027

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

int add(int n1, int n2);

#endif // MATH_H__20191027
</code></pre></div></div>

<p><code class="highlighter-rouge">test05/src/math/math.h</code>çš„å†…å®¹ã€‚</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test05# cat src/math/math.cpp 
#include "math.h"

int add(int n1, int n2) {
  return n1 + n2;
}
</code></pre></div></div>

<p>ç¼–è¯‘</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test05# cd build/

test05/build# cmake ..
-- The C compiler identification is GNU 5.4.0
-- The CXX compiler identification is GNU 5.4.0
-- Check for working C compiler: /usr/bin/cc
-- Check for working C compiler: /usr/bin/cc -- works
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - done
-- Detecting C compile features
-- Detecting C compile features - done
-- Check for working CXX compiler: /usr/bin/c++
-- Check for working CXX compiler: /usr/bin/c++ -- works
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - done
-- Detecting CXX compile features
-- Detecting CXX compile features - done
-- this is BINARY dir /tmp/c/2019-09-12-cmaketest/test05/build
-- this is SOURCE dir /tmp/c/2019-09-12-cmaketest/test05
-- Configuring done
-- Generating done
-- Build files have been written to: /tmp/c/2019-09-12-cmaketest/test05/build

test05/build# make
Scanning dependencies of target math
[ 25%] Building CXX object src/math/CMakeFiles/math.dir/math.cpp.o
[ 50%] Linking CXX static library ../../lib/libmath.a
[ 50%] Built target math
Scanning dependencies of target helloworld
[ 75%] Building CXX object src/main/CMakeFiles/helloworld.dir/helloworld.cpp.o
[100%] Linking CXX executable ../../bin/helloworld
[100%] Built target helloworld
</code></pre></div></div>

<p>è¿è¡Œ</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test05/build# ./bin/helloworld 
hello world
5 + 10 = 15
</code></pre></div></div>

<p>ç¼–è¯‘åçš„ç›®å½•æƒ…å†µï¼Œç”±äºCMakeFilesç›®å½•ä¸­çš„ä¸œè¥¿è¿‡å¤šï¼Œæ‰€ä»¥æ­¤å¤„å°†å…¶éšå»ã€‚</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test05# tree -F -L 3 -I CMakeFiles
.
â”œâ”€â”€ build/
â”‚Â Â  â”œâ”€â”€ bin/
â”‚Â Â  â”‚Â Â  â””â”€â”€ helloworld*
â”‚Â Â  â”œâ”€â”€ CMakeCache.txt
â”‚Â Â  â”œâ”€â”€ cmake_install.cmake
â”‚Â Â  â”œâ”€â”€ lib/
â”‚Â Â  â”‚Â Â  â””â”€â”€ libmath.a
â”‚Â Â  â”œâ”€â”€ Makefile
â”‚Â Â  â””â”€â”€ src/
â”‚Â Â      â”œâ”€â”€ cmake_install.cmake
â”‚Â Â      â”œâ”€â”€ main/
â”‚Â Â      â”œâ”€â”€ Makefile
â”‚Â Â      â””â”€â”€ math/
â”œâ”€â”€ CMakeLists.txt
â””â”€â”€ src/
    â”œâ”€â”€ CMakeLists.txt
    â”œâ”€â”€ main/
    â”‚Â Â  â”œâ”€â”€ CMakeLists.txt
    â”‚Â Â  â””â”€â”€ helloworld.cpp
    â””â”€â”€ math/
        â”œâ”€â”€ CMakeLists.txt
        â”œâ”€â”€ math.cpp
        â””â”€â”€ math.h

9 directories, 14 files
</code></pre></div></div>

<p>æ³¨æ„å…¶ä¸­libmath.aåº“æ–‡ä»¶çš„è·¯å¾„ä¸º<code class="highlighter-rouge">test05/build/lib/libmath.a</code></p>

<h3 id="é…ç½®æ–‡ä»¶test05srcmathcmakeliststxt">é…ç½®æ–‡ä»¶<code class="highlighter-rouge">test05/src/math/CMakeLists.txt</code></h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test05# cat src/math/CMakeLists.txt 
ADD_LIBRARY (math math.cpp)
SET (LIBRARY_OUTPUT_PATH ${PROJECT_BINARY_DIR}/lib)
</code></pre></div></div>

<h4 id="add_library-æ·»åŠ åº“">add_library æ·»åŠ åº“</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ADD_LIBRARY(libname [SHARED|STATIC|MODULE] [EXCLUDE_FROM_ALL] source1 source2 ... sourceN)
</code></pre></div></div>

<ul>
  <li>libnameï¼šä½ ä¸éœ€è¦å†™å…¨ libhello.soï¼Œåªéœ€è¦å¡«å†™ hello å³å¯ï¼Œcmake ç³»ç»Ÿä¼šè‡ªåŠ¨ä¸ºä½ ç”Ÿæˆ libhello.X</li>
  <li>ç”Ÿæˆçš„åº“ç±»å‹ï¼Œæœ‰ä¸‰ç§:
    <ul>
      <li>SHAREDï¼ŒåŠ¨æ€åº“</li>
      <li>STATICï¼Œé™æ€åº“</li>
      <li>MODULEï¼Œåœ¨ä½¿ç”¨ dyld çš„ç³»ç»Ÿæœ‰æ•ˆï¼Œå¦‚æœä¸æ”¯æŒ dyldï¼Œåˆ™è¢«å½“ä½œ SHARED å¯¹å¾…ã€‚</li>
    </ul>
  </li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ADD_LIBRARY(common math.cpp) # é»˜è®¤ç”Ÿæˆé™æ€åº“
ADD_LIBRARY(common STATIC math.cpp) # ç”Ÿæˆé™æ€åº“
ADD_LIBRARY(common SHARED math.cpp) # ç”ŸæˆåŠ¨æ€åº“
</code></pre></div></div>

<p>ä¸Šé¢é…ç½®å¯¹åº”åˆ†åˆ«ç”Ÿæˆï¼š</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>libmath.a
libmath.a
libmath.so
</code></pre></div></div>

<ul>
  <li>EXCLUDE_FROM_ALL å‚æ•°çš„æ„æ€æ˜¯è¿™ä¸ªåº“ä¸ä¼šè¢«é»˜è®¤æ„å»ºï¼Œé™¤éæœ‰å…¶ä»–çš„ç»„ä»¶ä¾èµ–æˆ–è€…æ‰‹å·¥æ„å»ºã€‚</li>
  <li>source1 source2 â€¦ sourceN æºæ–‡ä»¶åˆ—è¡¨</li>
</ul>

<p>é…ç½®æ–‡ä»¶ä¸­çš„<code class="highlighter-rouge">ADD_LIBRARY (math math.cpp)</code>ä»£è¡¨æ ¹æ®math.cppæºæ–‡ä»¶ç”Ÿæˆåä¸ºlibmath.açš„é™æ€åº“</p>

<h4 id="library_output_path-è®¾ç½®åº“å­˜æ”¾è·¯å¾„">LIBRARY_OUTPUT_PATH è®¾ç½®åº“å­˜æ”¾è·¯å¾„</h4>

<p>å’ŒEXECUTABLE_OUTPUT_PATHç±»ä¼¼çš„ï¼ŒLIBRARY_OUTPUT_PATHæŒ‡å®šäº†åº“è¾“å‡ºçš„ç›®å½•</p>

<p>è¿™é‡ŒæŒ‡å®šç¼–è¯‘ç›®å½•ä¸‹çš„libä½œä¸ºåº“è¾“å‡ºçš„ç›®å½•</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SET (LIBRARY_OUTPUT_PATH ${PROJECT_BINARY_DIR}/lib)
</code></pre></div></div>

<p>æ‰€ä»¥å¯ä»¥çœ‹åˆ°mathåº“çš„è·¯å¾„ä¸º<code class="highlighter-rouge">test05/build/lib/libmath.a</code></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test05# ll build/lib/libmath.a 
-rw-r--r-- 1 root root 1.4K Oct 27 16:13 build/lib/libmath.a
</code></pre></div></div>

<h3 id="é…ç½®æ–‡ä»¶test05srcmaincmakeliststxt">é…ç½®æ–‡ä»¶<code class="highlighter-rouge">test05/src/main/CMakeLists.txt</code></h3>

<p>ä½¿ç”¨äº†TARGET_LINK_LIBRARIESç”¨äºæŒ‡ç¤ºé“¾æ¥åº“mathã€‚å¯ä»¥æŒ‡å®šå…¨åç”¨äºé“¾æ¥åŠ¨æ€åº“æˆ–è€…é™æ€åº“ï¼Œå¦‚æœlibmath.aåˆ™é“¾æ¥é™æ€åº“ï¼Œlibmath.soåˆ™é“¾æ¥åŠ¨æ€åº“</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test05# cat src/main/CMakeLists.txt 
ADD_EXECUTABLE (helloworld helloworld.cpp)
SET (EXECUTABLE_OUTPUT_PATH ${PROJECT_BINARY_DIR}/bin)
TARGET_LINK_LIBRARIES (helloworld math)
</code></pre></div></div>

<h4 id="target_link_libraries-é“¾æ¥æ–‡ä»¶">target_link_libraries é“¾æ¥æ–‡ä»¶</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>TARGET_LINK_LIBRARIES(target library1 &lt;debug | optimized&gt; library2 ...)
</code></pre></div></div>

<p>è¿™ä¸ªæŒ‡ä»¤å¯ä»¥ç”¨æ¥ä¸º target æ·»åŠ éœ€è¦é“¾æ¥çš„å…±äº«åº“ï¼Œæœ¬ä¾‹ä¸­æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä½†æ˜¯åŒæ ·å¯ä»¥ç”¨äºä¸ºè‡ªå·±ç¼–å†™çš„å…±äº«åº“æ·»åŠ å…±äº«åº“é“¾æ¥ã€‚</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>TARGET_LINK_LIBRARIES(helloworld math)
</code></pre></div></div>

<p>ä¹Ÿå¯ä»¥å†™æˆ</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>TARGET_LINK_LIBRARIES(helloworld libmath.a)
</code></pre></div></div>

<h2 id="åŒæ—¶ç”Ÿæˆé™æ€ä¾èµ–åº“å’ŒåŠ¨æ€ä¾èµ–åº“">åŒæ—¶ç”Ÿæˆé™æ€ä¾èµ–åº“å’ŒåŠ¨æ€ä¾èµ–åº“</h2>

<p>æœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ›åŒæ—¶ç”Ÿæˆé™æ€åº“å’ŒåŠ¨æ€åº“ã€‚</p>

<p>å½“å‰è·¯å¾„</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test06# pwd
/tmp/c/2019-09-12-cmaketest/test06
</code></pre></div></div>

<p>å½“å‰ç›®å½•æƒ…å†µ</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test06# tree -F
.
â”œâ”€â”€ build/
â”œâ”€â”€ CMakeLists.txt
â””â”€â”€ src/
    â”œâ”€â”€ main/
    â”‚Â Â  â”œâ”€â”€ CMakeLists.txt
    â”‚Â Â  â””â”€â”€ helloworld.cpp
    â””â”€â”€ math/
        â”œâ”€â”€ CMakeLists.txt
        â”œâ”€â”€ math.cpp
        â””â”€â”€ math.h

4 directories, 6 files
</code></pre></div></div>

<p>ä¸Šé¢å†…å®¹éƒ½æ˜¯test05çš„æ‹·è´ï¼Œè¿™æ¬¡åªä¿®æ”¹<code class="highlighter-rouge">test06/src/math/CMakeLists.txt</code>æ–‡ä»¶</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test06# vi src/math/CMakeLists.txt 
ADD_LIBRARY (math_static STATIC math.cpp)
ADD_LIBRARY (math SHARED math.cpp)

SET_TARGET_PROPERTIES (math_static PROPERTIES OUTPUT_NAME "math")
GET_TARGET_PROPERTY (OUTPUT_VALUE math_static OUTPUT_NAME)

MESSAGE (STATUS "this is math_static OUTPUT_NAME:" ${OUTPUT_VALUE})

SET (LIBRARY_OUTPUT_PATH ${PROJECT_BINARY_DIR}/lib)
</code></pre></div></div>

<p>ç¼–è¯‘</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test06# cd build/

test06/build# cmake ..
-- The C compiler identification is GNU 5.4.0
-- The CXX compiler identification is GNU 5.4.0
-- Check for working C compiler: /usr/bin/cc
-- Check for working C compiler: /usr/bin/cc -- works
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - done
-- Detecting C compile features
-- Detecting C compile features - done
-- Check for working CXX compiler: /usr/bin/c++
-- Check for working CXX compiler: /usr/bin/c++ -- works
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - done
-- Detecting CXX compile features
-- Detecting CXX compile features - done
-- this is BINARY dir /tmp/c/2019-09-12-cmaketest/test06/build
-- this is SOURCE dir /tmp/c/2019-09-12-cmaketest/test06
-- this is math_static OUTPUT_NAME:math
-- Configuring done
-- Generating done
-- Build files have been written to: /tmp/c/2019-09-12-cmaketest/test06/build

test06/build# make
Scanning dependencies of target math
[ 16%] Building CXX object src/math/CMakeFiles/math.dir/math.cpp.o
[ 33%] Linking CXX shared library ../../lib/libmath.so
[ 33%] Built target math
Scanning dependencies of target helloworld
[ 50%] Building CXX object src/main/CMakeFiles/helloworld.dir/helloworld.cpp.o
[ 66%] Linking CXX executable ../../bin/helloworld
[ 66%] Built target helloworld
Scanning dependencies of target math_static
[ 83%] Building CXX object src/math/CMakeFiles/math_static.dir/math.cpp.o
[100%] Linking CXX static library ../../lib/libmath.a
[100%] Built target math_static
</code></pre></div></div>

<p>è¿è¡Œ</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test06/build# ./bin/helloworld 
hello world
5 + 10 = 15
</code></pre></div></div>

<p>æŸ¥çœ‹ç›®å½•ï¼Œå¯ä»¥çœ‹åˆ°<code class="highlighter-rouge">test06/build/lib</code>ä¸‹ç”Ÿæˆäº†libmath.aï¼ˆé™æ€åº“ï¼‰å’Œlibmath.so(åŠ¨æ€åº“)ã€‚</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test06/build# cd ..

test06# tree -F -L 3 -I CMakeFiles
.
â”œâ”€â”€ build/
â”‚Â Â  â”œâ”€â”€ bin/
â”‚Â Â  â”‚Â Â  â””â”€â”€ helloworld*
â”‚Â Â  â”œâ”€â”€ CMakeCache.txt
â”‚Â Â  â”œâ”€â”€ cmake_install.cmake
â”‚Â Â  â”œâ”€â”€ lib/
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ libmath.a
â”‚Â Â  â”‚Â Â  â””â”€â”€ libmath.so*
â”‚Â Â  â”œâ”€â”€ Makefile
â”‚Â Â  â””â”€â”€ src/
â”‚Â Â      â”œâ”€â”€ cmake_install.cmake
â”‚Â Â      â”œâ”€â”€ main/
â”‚Â Â      â”œâ”€â”€ Makefile
â”‚Â Â      â””â”€â”€ math/
â”œâ”€â”€ CMakeLists.txt
â””â”€â”€ src/
    â”œâ”€â”€ CMakeLists.txt
    â”œâ”€â”€ main/
    â”‚Â Â  â”œâ”€â”€ CMakeLists.txt
    â”‚Â Â  â””â”€â”€ helloworld.cpp
    â””â”€â”€ math/
        â”œâ”€â”€ CMakeLists.txt
        â”œâ”€â”€ math.cpp
        â””â”€â”€ math.h

9 directories, 15 files
</code></pre></div></div>

<h3 id="é…ç½®æ–‡ä»¶test06srcmathcmakeliststxt">é…ç½®æ–‡ä»¶<code class="highlighter-rouge">test06/src/math/CMakeLists.txt</code></h3>

<p>æ¥çœ‹çœ‹<code class="highlighter-rouge">test06/src/math/CMakeLists.txt</code>é…ç½®æ–‡ä»¶</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test06# vi src/math/CMakeLists.txt 
ADD_LIBRARY (math_static STATIC math.cpp)
ADD_LIBRARY (math SHARED math.cpp)

SET_TARGET_PROPERTIES (math_static PROPERTIES OUTPUT_NAME "math")
GET_TARGET_PROPERTY (OUTPUT_VALUE math_static OUTPUT_NAME)

MESSAGE (STATUS "this is math_static OUTPUT_NAME:" ${OUTPUT_VALUE})

SET (LIBRARY_OUTPUT_PATH ${PROJECT_BINARY_DIR}/lib)             
</code></pre></div></div>

<p>æ³¨æ„è¿™é‡Œå¦‚æœä½¿ç”¨å¦‚ä¸‹çš„è¯­æ³•ï¼Œé‚£ä¹ˆåªä¼šç”ŸæˆåŠ¨æ€åº“ï¼Œå› ä¸ºå¦‚æœé™æ€åº“å–åmathï¼Œé‚£ä¹ˆä¸ºé™æ€åº“æ ¹æœ¬æ²¡æœ‰è¢«æ„å»ºï¼Œä»ç„¶åªç”Ÿæˆä¸€ä¸ªåŠ¨æ€åº“ã€‚å› ä¸º math ä½œä¸ºä¸€ä¸ª target æ˜¯ä¸èƒ½é‡åçš„ï¼Œæ‰€ä»¥ï¼Œé™æ€åº“æ„å»ºæŒ‡ä»¤æ— æ•ˆã€‚</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ADD_LIBRARY (math STATIC math.cpp)
ADD_LIBRARY (math SHARED math.cpp)
</code></pre></div></div>

<p>æ‰€ä»¥æ­¤å¤„å°†é™æ€åº“ä½¿ç”¨çš„åç§°ä¸ºmath_static</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ADD_LIBRARY (math_static STATIC math.cpp)
ADD_LIBRARY (math SHARED math.cpp)
</code></pre></div></div>

<p>ä½†æ˜¯æˆ‘ä»¬åˆæƒ³è¦é™æ€åº“å’ŒåŠ¨æ€åº“å‡ºæ¥ä¹‹åçš„æ ·å­æ˜¯ï¼šlibmath.aå’Œlibmath.soï¼Œè€Œä¸æ˜¯libmath_static.aå’Œlibmath.soã€‚æ‰€ä»¥æ­¤å¤„ç”¨åˆ°äº†SET_TARGET_PROPERTIESå’ŒGET_TARGET_PROPERTY</p>

<h4 id="set_target_properties-è®¾ç½®ç›®æ ‡å±æ€§">set_target_properties è®¾ç½®ç›®æ ‡å±æ€§</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SET_TARGET_PROPERTIES(target1 target2 ... PROPERTIES prop1 value1 prop2 value2 ...)
</code></pre></div></div>

<p>è¿™æ¡æŒ‡ä»¤å¯ä»¥ç”¨æ¥è®¾ç½®è¾“å‡ºçš„åç§°ï¼Œå¯¹äºåŠ¨æ€åº“ï¼Œè¿˜å¯ä»¥ç”¨æ¥æŒ‡å®šåŠ¨æ€åº“ç‰ˆæœ¬å’Œ API ç‰ˆæœ¬ã€‚</p>

<p>åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åšçš„æ˜¯å‘ <code class="highlighter-rouge">t06/src/CMakeLists.txt</code> ä¸­æ·»åŠ ä¸€æ¡ï¼š</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SET_TARGET_PROPERTIES (math_static PROPERTIES OUTPUT_NAME "math")
</code></pre></div></div>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥åŒæ—¶å¾—åˆ°libmath.aå’Œlibmath.soä¸¤ä¸ªåº“äº†ã€‚ ä¸è¯¥å‘½ä»¤å¯¹åº”çš„æŒ‡ä»¤æ˜¯ï¼š</p>

<h4 id="get_target_property-è·å–ç›®æ ‡å±æ€§">get_target_property è·å–ç›®æ ‡å±æ€§</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET_TARGET_PROPERTY(VAR target property) 
</code></pre></div></div>

<p>å…·ä½“ç”¨æ³•å¦‚</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SET_TARGET_PROPERTIES (math_static PROPERTIES OUTPUT_NAME "math")
GET_TARGET_PROPERTY (OUTPUT_VALUE math_static OUTPUT_NAME)

MESSAGE (STATUS "this is math_static OUTPUT_NAME:" ${OUTPUT_VALUE})
</code></pre></div></div>

<p>ç•Œé¢å°±ä¼šè¾“å‡º</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-- this is math_static OUTPUT_NAME:math
</code></pre></div></div>

<h2 id="è®¾ç½®åŠ¨æ€åº“ç‰ˆæœ¬">è®¾ç½®åŠ¨æ€åº“ç‰ˆæœ¬</h2>

<p>å‰é¢çŸ¥é“SET_TARGET_PROPERTIESè¿˜å¯ä»¥æŒ‡å®šåŠ¨æ€åº“ç‰ˆæœ¬ï¼Œå·æ‡’ä¸€ä¸‹ï¼Œç›´æ¥ä¿®æ”¹ä¸Šä¸ªä¾‹å­ï¼Œæ·»åŠ <code class="highlighter-rouge">SET_TARGET_PROPERTIES(math PROPERTIES VERSION 1.2 SOVERSION 1)</code>è¿™ä¹ˆä¸€å¥ï¼Œå…¶ä¸­ VERSION æŒ‡ä»£åŠ¨æ€åº“ç‰ˆæœ¬ï¼ŒSOVERSION æŒ‡ä»£ API ç‰ˆæœ¬ã€‚</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test06# vi src/math/CMakeLists.txt 
DD_LIBRARY (math math.cpp)
ADD_LIBRARY (math_static STATIC math.cpp)
ADD_LIBRARY (math SHARED math.cpp)
SET_TARGET_PROPERTIES(math PROPERTIES VERSION 1.2 SOVERSION 1)

SET_TARGET_PROPERTIES (math_static PROPERTIES OUTPUT_NAME "math")
GET_TARGET_PROPERTY (OUTPUT_VALUE math_static OUTPUT_NAME)

MESSAGE (STATUS "this is math_static OUTPUT_NAME:" ${OUTPUT_VALUE})

SET (LIBRARY_OUTPUT_PATH ${PROJECT_BINARY_DIR}/lib)
</code></pre></div></div>

<p>æœ€åç¼–è¯‘ç”Ÿæˆå¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°libä¸­çš„åŠ¨æ€åº“å·²ç»å˜æˆå¸¦ç‰ˆæœ¬çš„äº†ã€‚</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test06/build# tree -F -L 3 -I CMakeFiles
.
â”œâ”€â”€ bin/
â”‚Â Â  â””â”€â”€ helloworld*
â”œâ”€â”€ CMakeCache.txt
â”œâ”€â”€ cmake_install.cmake
â”œâ”€â”€ lib/
â”‚Â Â  â”œâ”€â”€ libmath.a
â”‚Â Â  â”œâ”€â”€ libmath.so -&gt; libmath.so.1*
â”‚Â Â  â”œâ”€â”€ libmath.so.1 -&gt; libmath.so.1.2*
â”‚Â Â  â””â”€â”€ libmath.so.1.2*
â”œâ”€â”€ Makefile
â””â”€â”€ src/
    â”œâ”€â”€ cmake_install.cmake
    â”œâ”€â”€ main/
    â”‚Â Â  â”œâ”€â”€ cmake_install.cmake
    â”‚Â Â  â””â”€â”€ Makefile
    â”œâ”€â”€ Makefile
    â””â”€â”€ math/
        â”œâ”€â”€ cmake_install.cmake
        â””â”€â”€ Makefile

5 directories, 14 files
</code></pre></div></div>

<h2 id="æ·»åŠ å¤–éƒ¨ä¾èµ–åº“">æ·»åŠ å¤–éƒ¨ä¾èµ–åº“</h2>

<p>å‰é¢çš„ä¾‹å­ä½¿ç”¨æ˜¯é¡¹ç›®å†…çš„ä¾èµ–åº“ã€‚ç°åœ¨å°†helloworldç¨‹åºä¸­çš„mathåº“ç§»åˆ°å¤–éƒ¨ã€‚å› ä¸ºinstallæŒ‡ä»¤ä¸‹ä¸€æ¬¡æ‰è®²ï¼Œæ‰€ä»¥æ­¤å¤„å°±ç›´æ¥å°†mathåº“çš„å¤´æ–‡ä»¶å’ŒåŠ¨æ€åº“é™æ€åº“ç›´æ¥æ‹·åˆ°middlewareç›®å½•ä¸‹ã€‚</p>

<p>middlewareæ‰€åœ¨è·¯å¾„</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>middleware# pwd
/tmp/c/2019-09-12-cmaketest/middleware
</code></pre></div></div>

<p>middlewareä¸­å†…å®¹</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>middleware# tree
.
â”œâ”€â”€ include
â”‚Â Â  â””â”€â”€ math
â”‚Â Â      â””â”€â”€ math.h
â””â”€â”€ lib
    â”œâ”€â”€ libmath.a
    â”œâ”€â”€ libmath.so
    â”œâ”€â”€ libmath.so.1
    â””â”€â”€ libmath.so.1.2
</code></pre></div></div>

<p>å½“å‰ç›®å½•ï¼Œç›¸å¯¹äºä¸Šä¸€ä¸ªä¾‹å­test06ï¼Œå·²å°†mathæ¨¡å—ç§»é™¤ï¼Œå¹¶ä¸”åšäº†ä¸€äº›ä¿®æ”¹</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test07# pwd
/tmp/c/2019-09-12-cmaketest/test07
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test07# tree
.
â”œâ”€â”€ build
â”œâ”€â”€ CMakeLists.txt
â””â”€â”€ src
    â”œâ”€â”€ CMakeLists.txt
    â””â”€â”€ main
        â”œâ”€â”€ CMakeLists.txt
        â””â”€â”€ helloworld.cpp

3 directories, 4 files
</code></pre></div></div>

<p><code class="highlighter-rouge">test07/CMakeLists.txt</code>çš„å†…å®¹ï¼Œæ·»åŠ äº†INCLUDE_DIRECTORIESå’ŒLINK_DIRECTORIESï¼Œåˆ†åˆ«æŒ‡å‘å¤´æ–‡ä»¶å’Œåº“æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test07# vi CMakeLists.txt 
CMAKE_MINIMUM_REQUIRED (VERSION 2.6)
PROJECT (HELLOWORLD)
MESSAGE (STATUS "this is BINARY dir " ${HELLOWORLD_BINARY_DIR})
MESSAGE (STATUS "this is SOURCE dir " ${HELLOWORLD_SOURCE_DIR})
# ADD_EXECUTABLE (helloworld helloworld.cpp)

INCLUDE_DIRECTORIES (/tmp/c/2019-09-12-cmaketest/middleware/include)
LINK_DIRECTORIES (/tmp/c/2019-09-12-cmaketest/middleware/lib)

ADD_SUBDIRECTORY (src)
</code></pre></div></div>

<p><code class="highlighter-rouge">test07/src/CMakeLists.txt</code>çš„å†…å®¹ï¼Œç°åœ¨åªæœ‰mainä¸€ä¸ªå­ç›®å½•äº†</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test07# vi src/CMakeLists.txt 
ADD_SUBDIRECTORY (main)
</code></pre></div></div>

<p><code class="highlighter-rouge">test07/src/main/CMakeLists.txt</code>çš„å†…å®¹æ²¡æœ‰æ”¹å˜</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test07# vi src/main/CMakeLists.txt 
ADD_EXECUTABLE (helloworld helloworld.cpp)
SET (EXECUTABLE_OUTPUT_PATH ${PROJECT_BINARY_DIR}/bin)
TARGET_LINK_LIBRARIES (helloworld math)
</code></pre></div></div>

<p><code class="highlighter-rouge">test07/src/main/helloworld.cpp</code>çš„å†…å®¹ï¼Œæ³¨æ„å°†å¼•å…¥å¤´æ–‡ä»¶math.hçš„æ–¹å¼ç”± <code class="highlighter-rouge">#include "../math/math.h"</code> æ”¹ä¸º <code class="highlighter-rouge">#include "math/math.h"</code></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test07# vi src/main/helloworld.cpp 
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include "math/math.h"

int main(int argc, char * args[]) {
  printf("hello world\n");
  int n1 = 5;
  int n2 = 10;
  int nRet = add(5, 10);
  printf("%d + %d = %d\n", n1, n2, nRet);
}
</code></pre></div></div>

<p>ç¼–è¯‘</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test07# cd build/

test07/build# cmake ..
-- The C compiler identification is GNU 5.4.0
-- The CXX compiler identification is GNU 5.4.0
-- Check for working C compiler: /usr/bin/cc
-- Check for working C compiler: /usr/bin/cc -- works
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - done
-- Detecting C compile features
-- Detecting C compile features - done
-- Check for working CXX compiler: /usr/bin/c++
-- Check for working CXX compiler: /usr/bin/c++ -- works
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - done
-- Detecting CXX compile features
-- Detecting CXX compile features - done
-- this is BINARY dir /tmp/c/2019-09-12-cmaketest/test07/build
-- this is SOURCE dir /tmp/c/2019-09-12-cmaketest/test07
-- Configuring done
-- Generating done
-- Build files have been written to: /tmp/c/2019-09-12-cmaketest/test07/build

build# make
Scanning dependencies of target helloworld
[ 50%] Building CXX object src/main/CMakeFiles/helloworld.dir/helloworld.cpp.o
[100%] Linking CXX executable ../../bin/helloworld
[100%] Built target helloworld
</code></pre></div></div>

<p>è¿è¡Œ</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>build# ./bin/helloworld 
hello world
5 + 10 = 15
</code></pre></div></div>

<h3 id="é…ç½®æ–‡ä»¶test07cmakeliststxt">é…ç½®æ–‡ä»¶<code class="highlighter-rouge">test07/CMakeLists.txt</code></h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test07# vi CMakeLists.txt 
CMAKE_MINIMUM_REQUIRED (VERSION 2.6)
PROJECT (HELLOWORLD)
MESSAGE (STATUS "this is BINARY dir " ${HELLOWORLD_BINARY_DIR})
MESSAGE (STATUS "this is SOURCE dir " ${HELLOWORLD_SOURCE_DIR})
# ADD_EXECUTABLE (helloworld helloworld.cpp)

INCLUDE_DIRECTORIES (/tmp/c/2019-09-12-cmaketest/middleware/include)
LINK_DIRECTORIES (/tmp/c/2019-09-12-cmaketest/middleware/lib)

ADD_SUBDIRECTORY (src)
</code></pre></div></div>

<p>è¯¥æ–‡ä»¶æ·»åŠ äº†INCLUDE_DIRECTORIESå’ŒLINK_DIRECTORIESæŒ‡ä»¤ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†è¿™ä¸¤ä¸ªå‘½ä»¤å†™åœ¨<code class="highlighter-rouge">test07/src/main/CMakeLists.txt</code>ä¸­ï¼Œä½†æ˜¯è¿™ç§ä¸€èˆ¬æ˜¯å†™åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­çš„CMakeLists.txtä¸­</p>

<h4 id="include_directories-åŒ…å«å¤´æ–‡ä»¶ç›®å½•">include_directories åŒ…å«å¤´æ–‡ä»¶ç›®å½•</h4>

<p>ç”¨æ¥æŒ‡å®šéœ€è¦çš„å¤´æ–‡ä»¶è·¯å¾„</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INCLUDE_DIRECTORIES (/tmp/c/2019-09-12-cmaketest/middleware/include)
</code></pre></div></div>
<p>æ­¤å¤„æŒ‡å®šäº†åŒ…å«çš„ç›®å½•ä¸º<code class="highlighter-rouge">/tmp/c/2019-09-12-cmaketest/middleware/include</code>ï¼Œä½†æ˜¯math.hçš„è·¯å¾„æ˜¯<code class="highlighter-rouge">/tmp/c/2019-09-12-cmaketest/middleware/include/math/math.h</code>ï¼Œæ‰€ä»¥åœ¨helloworld.cppä¸­ä½¿ç”¨å¦‚ä¸‹æ–¹å¼æ¥å¼•ç”¨ã€‚</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#include "math/math.h"
</code></pre></div></div>

<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥æŒ‡å®š<code class="highlighter-rouge">/tmp/c/2019-09-12-cmaketest/middleware/include/math</code>ï¼Œè¿™æ ·å°±ç›´æ¥å¦‚ä¸‹å¼•ç”¨å³å¯</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#include "math.h"
</code></pre></div></div>
<p>ä½†å› ä¸ºæˆ‘ä»¬åˆ°æ—¶å€™å¯èƒ½ä½¿ç”¨çš„ä¸æ­¢ä¸€ä¸ªåº“ï¼Œå¯èƒ½æ˜¯å¤šä¸ªåœ¨middlewareä¸‹çš„åº“ï¼Œæ‰€ä»¥è¯¥è·¯å¾„åˆ°includeå³å¯ã€‚</p>

<h4 id="link_directories-åŒ…å«åº“æ–‡ä»¶ç›®å½•">link_directories åŒ…å«åº“æ–‡ä»¶ç›®å½•</h4>

<p>ç”¨æ¥æŒ‡å®šç¬¬ä¸‰æ–¹åº“æ‰€åœ¨çš„è·¯å¾„ï¼Œå¯ä»¥ç†è§£ä¸ºgccä¸­çš„-L</p>

<p>â€”åˆ†å‰²çº¿</p>

<p>åˆåˆ°äº†æ°é¥­çš„ç‚¹äº†ï¼Œä¸‹æ¬¡æ•´ç†INSTALLã€‚</p>

<h2 id="å‚è€ƒ">å‚è€ƒ</h2>

<ul>
  <li>cmake practice</li>
  <li><a href="https://www.cnblogs.com/liu3yuan/p/6895419.html">ä¸ºä½•è¦ä½¿ç”¨cmakeä¸­æ–‡ç¿»è¯‘å‚è€ƒ</a></li>
  <li><a href="https://cmake.org/cmake/help/latest/manual/cmake-variables.7.html#variables-that-change-behavior">cmakeå˜é‡</a></li>
</ul>
:ET