I"Ìq<h1 id="cmake">CMake</h1>

<h2 id="cmakeæ˜¯ä»€ä¹ˆ">cmakeæ˜¯ä»€ä¹ˆ</h2>

<blockquote>
  <p>CMake is an open-source, cross-platform family of tools designed to build, test and package software. CMake is used to control the software compilation process using simple platform and compiler independent configuration files, and generate native makefiles and workspaces that can be used in the compiler environment of your choice. 
â€“æ¥è‡ªå®˜ç½‘çš„è§£è¯´</p>
</blockquote>

<p>ç¿»è¯‘æˆç™½è¯æ–‡å°±æ˜¯</p>

<p>CMakeæ˜¯ä¸€ä¸ªä»¥ç¼–è¯‘ã€æµ‹è¯•ã€æ‰“åŒ…è½¯ä»¶ä¸ºç›®æ ‡çš„å¼€æºã€è·¨å¹³å°çš„å·¥å…·é›†ï¼ŒCMakeä½¿ç”¨ç®€å•çš„ä¸å¹³å°å’Œç¼–è¯‘å™¨æ— å…³çš„é…ç½®æ–‡ä»¶æ¥æ§åˆ¶è½¯ä»¶çš„ç¼–è¯‘è¿‡ç¨‹ï¼Œå¹¶ç”Ÿæˆæ‚¨é€‰æ‹©çš„ç¼–è¯‘å™¨ç¯å¢ƒä¸­å¯ä½¿ç”¨çš„æœ¬åœ°makefileå’Œå·¥ä½œåŒºã€‚</p>

<h2 id="why-cmake">why cmake?</h2>

<p>å¦å¤–æœ‰ä¸€ä¸ªautotoolså·¥å…·é›†ï¼Œä¹Ÿæ˜¯ç›¸åŒçš„ä½œç”¨ï¼Œå½“å‰githubä¸Šé¢æœ‰è®¸å¤šé¡¹ç›®ä½¿ç”¨å®ƒï¼Œä½†å®ƒæ¯”CMakeå¤æ‚ã€‚</p>

<p>master-cmakeè¿™æœ¬ä¹¦ï¼Œç¬¬ä¸€ç« å°±è§£é‡Šä¸ºä»€ä¹ˆç”¨cmakeï¼Œåˆ—ä¸¾cmakeçš„å„é¡¹ä¼˜ç‚¹ä»¥åŠå’Œautotoolsçš„æ¯”è¾ƒã€‚</p>

<h2 id="ä¸€ä¸ªç®€å•çš„ä¾‹å­">ä¸€ä¸ªç®€å•çš„ä¾‹å­</h2>

<p>å½“å‰æ‰€åœ¨è·¯å¾„</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test01# pwd
/tmp/c/2019-09-12-cmaketest/test01
</code></pre></div></div>

<p>å½“å‰ç›®å½•ä¸­çš„æ–‡ä»¶/æ–‡ä»¶å¤¹</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test01# tree -F
.
â””â”€â”€ helloworld.cpp

0 directories, 1 file
</code></pre></div></div>

<p>helloworld.cppå†…å®¹å¾ˆç®€å•ï¼Œå°±æ‰“å°ä¸€ä¸ªhello world</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

int main(int argc, char * args[]) {
  printf("hello world\n");
}
</code></pre></div></div>

<p>æˆ‘ä»¬æƒ³è¦ç¼–è¯‘è¿™ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test01# gcc -o helloworld helloworld.cpp
</code></pre></div></div>

<p>æ­¤æ—¶ç”Ÿæˆäº†ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶helloworld</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test01# tree -F
.
â”œâ”€â”€ helloworld*
â””â”€â”€ helloworld.cpp

0 directories, 2 files
</code></pre></div></div>

<p>æˆ‘ä»¬ç°åœ¨å¯ä»¥æ„‰å¿«çš„è¿è¡Œè¿™ä¸ªhelloworld</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test01# ./helloworld 
hello world
</code></pre></div></div>

<h2 id="å°†ä¸Šé¢ä¾‹å­æ”¹é€ æˆcmakeæ–¹å¼ç¼–è¯‘">å°†ä¸Šé¢ä¾‹å­æ”¹é€ æˆCMakeæ–¹å¼ç¼–è¯‘</h2>

<p>å½“å‰æ‰€åœ¨è·¯å¾„</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test02# pwd
/tmp/c/2019-09-12-cmaketest/test02
</code></pre></div></div>

<p>å½“å‰ç›®å½•ä¸­çš„æ–‡ä»¶/æ–‡ä»¶å¤¹</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test02# tree -F
.
â”œâ”€â”€ CMakeLists.txt
â””â”€â”€ helloworld.cpp

0 directories, 2 files
</code></pre></div></div>

<p>å…¶ä¸­helloworld.cppè¿˜æ˜¯test01ä¸­çš„è€æ ·å­ï¼ŒCMakeLists.txtåˆ™æ˜¯æœ€å¼€å§‹æåˆ°çš„â€“CMakeä½¿ç”¨çš„ä¸å¹³å°å’Œç¼–è¯‘å™¨æ— å…³çš„é…ç½®æ–‡ä»¶ã€‚</p>

<p>CMakeLists.txtçš„å†…å®¹ï¼Œé…ç½®é¡¹å«ä¹‰ç¨åè§£é‡Šã€‚</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test02# cat CMakeLists.txt 
# æ‰€éœ€CMAKEæœ€ä½ç‰ˆæœ¬ï¼Œè‹¥å½“å‰ä½¿ç”¨ç‰ˆæœ¬ä½äºæ­¤æœ€ä½ç‰ˆæœ¬ï¼Œåˆ™æŠ¥é”™é€€å‡º
CMAKE_MINIMUM_REQUIRED (VERSION 2.6)
# é¡¹ç›®åç§°
PROJECT (HELLOWORLD)
# æ‰“å°ä¿¡æ¯
MESSAGE (STATUS "this is BINARY dir " ${HELLOWORLD_BINARY_DIR})
MESSAGE (STATUS "this is SOURCE dir " ${HELLOWORLD_SOURCE_DIR})
# ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶hellworld
ADD_EXECUTABLE (helloworld helloworld.cpp)
</code></pre></div></div>

<p>ç°åœ¨æˆ‘ä»¬æœ‰äº†é…ç½®æ–‡ä»¶å’Œé¡¹ç›®æºæ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨cmakeæ¥ç¼–è¯‘ä¸€ä¸‹äº†</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test02# cmake .
-- The C compiler identification is GNU 5.4.0
-- The CXX compiler identification is GNU 5.4.0
-- Check for working C compiler: /usr/bin/cc
-- Check for working C compiler: /usr/bin/cc -- works
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - done
-- Detecting C compile features
-- Detecting C compile features - done
-- Check for working CXX compiler: /usr/bin/c++
-- Check for working CXX compiler: /usr/bin/c++ -- works
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - done
-- Detecting CXX compile features
-- Detecting CXX compile features - done
-- this is BINARY dir /tmp/c/2019-09-12-cmaketest/test02
-- this is SOURCE dir /tmp/c/2019-09-12-cmaketest/test02
-- Configuring done
-- Generating done
-- Build files have been written to: /tmp/c/2019-09-12-cmaketest/test02
</code></pre></div></div>

<p>å†çœ‹ä¸€ä¸‹å½“å‰ç›®å½•ä¸‹çš„ç¬¬ä¸€å±‚æ–‡ä»¶/æ–‡ä»¶å¤¹ï¼Œç”Ÿæˆäº†ä¸€å †ä¸œè¥¿ï¼Œé™¤å¼€åŸæ¥æœ‰çš„CMakeLists.txtå’Œhelloworld.cppï¼Œç”Ÿæˆäº†CMakeCache.txtã€CMakeFilesæ–‡ä»¶å¤¹ï¼ˆå…¶ä¸­åŒ…å«æ–‡ä»¶æ²¡æœ‰æ˜¾ç¤ºï¼‰ã€cmake_install.cmakeã€Makefileï¼Œè¿™äº›ä¸œè¥¿å°±æ˜¯å‰é¢è¯´çš„â€“ç”Ÿæˆæ‚¨é€‰æ‹©çš„ç¼–è¯‘å™¨ç¯å¢ƒä¸­å¯ä½¿ç”¨çš„æœ¬åœ°makefileå’Œå·¥ä½œåŒºã€‚</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test02# tree -F -L 1
.
â”œâ”€â”€ CMakeCache.txt
â”œâ”€â”€ CMakeFiles/
â”œâ”€â”€ cmake_install.cmake
â”œâ”€â”€ CMakeLists.txt
â”œâ”€â”€ helloworld.cpp
â””â”€â”€ Makefile

1 directory, 5 files
</code></pre></div></div>

<p>æœ‰äº†è¿™äº›ä¸œè¥¿ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨makeå‘½ä»¤ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶äº†</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test02# make
Scanning dependencies of target helloworld
[ 50%] Building CXX object CMakeFiles/helloworld.dir/helloworld.cpp.o
[100%] Linking CXX executable helloworld
[100%] Built target helloworld
</code></pre></div></div>

<p>å½“å‰ç›®å½•ä¸‹çš„ç¬¬ä¸€å±‚æ–‡ä»¶/æ–‡ä»¶å¤¹</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test02# tree -F -L 1
.
â”œâ”€â”€ CMakeCache.txt
â”œâ”€â”€ CMakeFiles/
â”œâ”€â”€ cmake_install.cmake
â”œâ”€â”€ CMakeLists.txt
â”œâ”€â”€ helloworld*
â”œâ”€â”€ helloworld.cpp
â””â”€â”€ Makefile

1 directory, 6 files
</code></pre></div></div>

<p>å¤šå‡ºäº†ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶hellworldï¼Œæˆ‘ä»¬è¿™æ—¶å€™å°±å¯ä»¥è¿è¡Œè¿™ä¸ªhelloworldäº†ã€‚</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test02# ./helloworld 
hello world
</code></pre></div></div>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥è§£é‡Šä¸€ä¸‹ä¸Šé¢çš„ä¸€äº›ä¸œè¥¿</p>

<h3 id="why-cmake-1">why cmake?</h3>

<p>ç®€å•çš„ä¾‹å­é‡Œé¢ï¼Œç”¨gccç¼–è¯‘ä¸€ä¸‹å°±å¯ä»¥æ„‰å¿«çš„è¿è¡Œäº†</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test01# gcc -o helloworld helloworld.cpp
</code></pre></div></div>
<p>è€Œcmakeå´è¦ç¼–è¯‘ä¸€ä¸ªCMakeLists.txté…ç½®æ–‡ä»¶ï¼Œç„¶åcmakeç”Ÿæˆä¸€å †ä¸œè¥¿ï¼Œå†makeæ‰èƒ½è¾¾åˆ°ä¸Šé¢ä¸€å¥ç›¸åŒçš„ä½œç”¨ï¼Œæ˜¯ä¸æ˜¯è®©ä½ æ€€ç–‘ä¸ºä»€ä¹ˆè¦ç”¨cmakeäº†ï¼Ÿå’Œmavenã€antç­‰ä¸€äº›å·¥å…·ç±»ä¼¼çš„ï¼Œå½“é¡¹ç›®éå¸¸ç®€å•çš„æ—¶å€™ï¼Œä¸ç”¨å·¥å…·æ‰‹åŠ¨ç¼–è¯‘è¿˜æ›´å¿«ï¼Œä½†æ˜¯é¡¹ç›®å¤æ‚èµ·æ¥ï¼Œå‡ åä¸ªå‡ ç™¾ä¸ªæºæ–‡ä»¶çš„æ—¶å€™ï¼Œä½ å°±ä¼šä½“ä¼šåˆ°å·¥å…·å¸¦æ¥çš„å¥½å¤„äº†ã€‚</p>

<h3 id="cmake-å’Œ-make-æ˜¯ä»€ä¹ˆä¸œè¥¿">cmake å’Œ make æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Ÿ</h3>

<p>ä»–ä¿©éƒ½æ˜¯å‘½ä»¤ã€‚</p>

<p>çœ‹çœ‹cmakeçš„å¸®åŠ©æ–‡æ¡£</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test02# man cmake
...
DESCRIPTION
       The "cmake" executable is the CMake command-line interface.  It may be used to configure projects in scripts.  Project configuraâ€
       tion settings may be specified on the command line with the -D option.

       CMake is a cross-platform build system generator.  Projects specify their build process with platform-independent CMake listfiles
       included  in  each  directory  of a source tree with the name CMakeLists.txt.  Users build a project by using CMake to generate a
       build system for a native tool on their platform.
...
</code></pre></div></div>

<p>ç¿»è¯‘ä¹‹</p>

<p>â€œcmakeâ€å¯æ‰§è¡Œæ–‡ä»¶æ˜¯cmakeå‘½ä»¤è¡Œæ¥å£ã€‚å®ƒå¯ä»¥ç”¨äºåœ¨è„šæœ¬ä¸­é…ç½®é¡¹ç›®ã€‚é¡¹ç›®çš„é…ç½®é¡¹å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨-Dé€‰é¡¹æŒ‡å®šã€‚</p>

<p>CMakeæ˜¯ä¸€ä¸ªè·¨å¹³å°çš„æ„å»ºç³»ç»Ÿç”Ÿæˆå™¨ã€‚é¡¹ç›®ä½¿ç”¨ä¸å¹³å°æ— å…³çš„ã€åœ¨æ¯ä¸ªåŒ…å«æºæ–‡ä»¶çš„æ–‡ä»¶å¤¹ä¸­çš„åä¸ºCMakeLists.txtæŒ‡å®šç¼–è¯‘è¿‡ç¨‹ã€‚ç”¨æˆ·ä½¿ç”¨CMakeç”Ÿæˆä¸€ä¸ªé¡¹ç›®åœ¨ä»–ä»¬çš„å¹³å°ä¸Šä¸ºæœ¬åœ°å·¥å…·æ„å»ºç³»ç»Ÿã€‚</p>

<p>å†çœ‹çœ‹makeçš„å¸®åŠ©æ–‡æ¡£</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test02# man make
...
DESCRIPTION
       The  make  utility  will determine automatically which pieces of a large program need to be recompiled, and issue the commands to
       recompile them.  The manual describes the GNU implementation of make, which was written by Richard Stallman and  Roland  McGrath,
       and  is  currently maintained by Paul Smith.  Our examples show C programs, since they are very common, but you can use make with
       any programming language whose compiler can be run with a shell command.  In fact, make is not limited to programs.  You can  use
       it to describe any task where some files must be updated automatically from others whenever the others change.

       To  prepare  to use make, you must write a file called the makefile that describes the relationships among files in your program,
       and the states the commands for updating each file.  In a program, typically the executable file is updated  from  object  files,
       which are in turn made by compiling source files.

       Once a suitable makefile exists, each time you change some source files, this simple shell command:

              make

       suffices to perform all necessary recompilations.  The make program uses the makefile description and the last-modification times
       of the files to decide which of the files need to be updated.  For each of those files, it issues the commands  recorded  in  the
       makefile.

       make executes commands in the makefile to update one or more target names, where name is typically a program.  If no -f option is
       present, make will look for the makefiles GNUmakefile, makefile, and Makefile, in that order.

       Normally you should call your makefile either makefile or Makefile.  (We recommend Makefile because it appears  prominently  near
       the  beginning of a directory listing, right near other important files such as README.)  The first name checked, GNUmakefile, is
       not recommended for most makefiles.  You should use this name if you have a makefile that is specific to GNU make, and  will  not
       be understood by other versions of make.  If makefile is '-', the standard input is read.

       make  updates  a target if it depends on prerequisite files that have been modified since the target was last modified, or if the
       target does not exist.
...
</code></pre></div></div>

<p>ç¿»è¯‘ä¹‹</p>

<p>makeç¨‹åºå°†è‡ªåŠ¨ç¡®å®šä¸€ä¸ªå¤§å‹ç¨‹åºçš„å“ªäº›éƒ¨åˆ†éœ€è¦é‡æ–°ç¼–è¯‘ï¼Œå¹¶å‘å‡ºå‘½ä»¤é‡æ–°ç¼–è¯‘å®ƒä»¬ã€‚æ‰‹å†Œæè¿°äº†makeçš„GNUå®ç°ï¼Œå®ƒæ˜¯ç”±Richard Stallmanå’ŒRoland McGrathç¼–å†™çš„ï¼Œç›®å‰ç”±ä¿ç½—Â·å²å¯†æ–¯ç»´æŠ¤ã€‚æˆ‘ä»¬çš„ç¤ºä¾‹å±•ç¤ºäº†Cç¨‹åºï¼Œå› ä¸ºå®ƒä»¬éå¸¸å¸¸è§ï¼Œä½†æ˜¯æ‚¨å¯ä»¥ä½¿ç”¨make withä»»ä½•ä¸€ç§ç¼–ç¨‹è¯­è¨€ï¼Œå…¶ç¼–è¯‘å™¨å¯ä»¥ç”¨shellå‘½ä»¤è¿è¡Œã€‚äº‹å®ä¸Šï¼Œmakeå¹¶ä¸å±€é™äºç¨‹åºã€‚æ‚¨å¯ä»¥ä½¿ç”¨å®ƒæè¿°ä»»ä½•ä»»åŠ¡ï¼Œå…¶ä¸­ä¸€äº›æ–‡ä»¶å¿…é¡»åœ¨å…¶ä»–æ–‡ä»¶æ›´æ”¹æ—¶ä»å…¶ä»–æ–‡ä»¶è‡ªåŠ¨æ›´æ–°ã€‚</p>

<p>è¦å‡†å¤‡ä½¿ç”¨makeï¼Œæ‚¨å¿…é¡»ç¼–å†™ä¸€ä¸ªåä¸ºmakefileçš„æ–‡ä»¶æ¥æè¿°ç¨‹åºä¸­æ–‡ä»¶ä¹‹é—´çš„å…³ç³»ï¼Œä»¥åŠç”¨äºæ›´æ–°æ¯ä¸ªæ–‡ä»¶çš„å‘½ä»¤ã€‚åœ¨ç¨‹åºä¸­ï¼Œé€šå¸¸å¯æ‰§è¡Œæ–‡ä»¶æ˜¯ä»ç›®æ ‡æ–‡ä»¶æ›´æ–°çš„ï¼Œå®ƒä»¬æ˜¯é€šè¿‡ç¼–è¯‘æºæ–‡ä»¶æ¥å®ç°çš„ã€‚</p>

<p>ä¸€æ—¦ä¸€ä¸ªåˆé€‚çš„makefileå­˜åœ¨ï¼Œæ¯æ¬¡ä½ æ”¹å˜ä¸€äº›æºæ–‡ä»¶ï¼Œè¿™ä¸ªç®€å•çš„shellå‘½ä»¤:</p>

<p>make</p>

<p>è¶³ä»¥æ‰§è¡Œæ‰€æœ‰å¿…è¦çš„é‡æ–°ç¼–è¯‘ã€‚makeç¨‹åºä½¿ç”¨makefileæè¿°å’Œæœ€åä¿®æ”¹æ—¶é—´æ¥å†³å®šå“ªäº›æ–‡ä»¶éœ€è¦æ›´æ–°,å¯¹äºæ¯ä¸ªæ–‡ä»¶ï¼Œå®ƒå‘å‡ºmakefileä¸­è®°å½•çš„å‘½ä»¤ã€‚</p>

<p>makeåœ¨makefileä¸­æ‰§è¡Œå‘½ä»¤æ¥æ›´æ–°ä¸€ä¸ªæˆ–å¤šä¸ªç›®æ ‡åç§°ï¼Œå…¶ä¸­åç§°é€šå¸¸æ˜¯ä¸€ä¸ªç¨‹åºã€‚å¦‚æœæ²¡æœ‰-fé€‰é¡¹ï¼Œç°åœ¨ï¼Œmakeå°†æŒ‰ç…§è¿™ä¸ªé¡ºåºæŸ¥æ‰¾ä»¥ä¸‹çš„makefileæ–‡ä»¶ï¼šGNUmakefileã€makefileå’ŒMakefileã€‚</p>

<p>é€šå¸¸ï¼Œæ‚¨åº”è¯¥å°†makefileæ–‡ä»¶å‘½åä¸ºmakefileæˆ–Makefileã€‚(æˆ‘ä»¬æ¨èMakefileï¼Œå› ä¸ºå®ƒåœ¨æ˜¾è‘—ä½ç½®é™„è¿‘ç›®å½•åˆ—è¡¨çš„å¼€å¤´ï¼Œç´§æŒ¨ç€å…¶ä»–é‡è¦æ–‡ä»¶ï¼Œå¦‚READMEã€‚)é€‰ä¸­çš„ç¬¬ä¸€ä¸ªåç§°GNUmakefileæ˜¯ä¸æ¨èå¤§å¤šæ•°makefileã€‚å¦‚æœæ‚¨æœ‰ä¸€ä¸ªç‰¹å®šäºGNU makeçš„makefileï¼Œè€Œä¸æ˜¯willï¼Œé‚£ä¹ˆæ‚¨åº”è¯¥ä½¿ç”¨è¿™ä¸ªåç§°è¢«makeçš„å…¶ä»–ç‰ˆæœ¬æ‰€ç†è§£ã€‚å¦‚æœmakefileæ˜¯â€™-â€˜ï¼Œåˆ™è¯»å–æ ‡å‡†è¾“å…¥ã€‚</p>

<p>makeæ›´æ–°ç›®æ ‡å–å†³äºè‡ªä¸Šæ¬¡ä¿®æ”¹ç›®æ ‡ä»¥æ¥å·²ä¿®æ”¹çš„å…ˆå†³æ¡ä»¶æ–‡ä»¶ï¼Œæˆ–è€…ç›®æ ‡ä¸å­˜åœ¨ã€‚</p>

<p>â€”åˆ†å‰²çº¿åœ¨æ­¤</p>

<p>ä»å‰é¢çš„æ–‡æ¡£å¯ä»¥çœ‹åˆ°makeæ˜¯ä¸å±äºcmakeçš„ä¸€éƒ¨åˆ†çš„ï¼Œcmakeæ¥ç”Ÿæˆmakeæ–‡ä»¶éœ€è¦çš„Makefileæ–‡ä»¶ï¼Œmakeå†ç”¨Makefileæ–‡ä»¶ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶helloworldã€‚</p>

<p>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨ç¼–è¾‘Makefileæ–‡ä»¶ï¼Œç„¶åç›´æ¥ç”¨makeæ¥è¿è¡Œä¹Ÿèƒ½ç”Ÿæˆhelloworldï¼Œä½†æ˜¯çœ‹çœ‹Makefileæ–‡ä»¶ä¸­çš„è¶³æœ‰178è¡Œï¼ˆå»æ‰ç©ºè¡Œå’Œæ³¨é‡Šè¡Œä¹Ÿè¿˜æœ‰å¾ˆå¤šè¡Œï¼‰ï¼Œæ˜¯ä»€ä¹ˆè®©æˆ‘ä»¬æœ›è€Œå´æ­¥ 0.0 ã€‚</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test02# wc -l Makefile 
178 Makefile
</code></pre></div></div>

<p>å¦‚æœå¯¹cmake,makeæƒ³è¦æ›´å¤šçš„äº†è§£ï¼Œä½ ä»¬å¯ä»¥ç”¨manå»çœ‹è¯¦ç»†é…ç½®é¡¹åŠä¿¡æ¯ã€‚</p>

<h3 id="cmakeç”Ÿæˆäº†äº›å•¥">cmakeç”Ÿæˆäº†äº›å•¥ï¼Ÿ</h3>

<p>å†çœ‹çœ‹test02æœ€åç›®å½•ä¸­çš„æ–‡ä»¶/æ–‡ä»¶å¤¹</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test02# tree -F -L 1
.
â”œâ”€â”€ CMakeCache.txt
â”œâ”€â”€ CMakeFiles/
â”œâ”€â”€ cmake_install.cmake
â”œâ”€â”€ CMakeLists.txt
â”œâ”€â”€ helloworld*           å¯æ‰§è¡Œæ–‡ä»¶
â”œâ”€â”€ helloworld.cpp        æºæ–‡ä»¶
â””â”€â”€ Makefile

1 directory, 6 files
</code></pre></div></div>

<h4 id="cmakecachetxt">CMakeCache.txt</h4>

<p>CMakeCache.txtæ˜¯è¿è¡Œcmakeä¹‹åï¼Œcmakeæ ¹æ®CMakeLists.txtç”Ÿæˆçš„ç¼“å­˜æ–‡ä»¶ï¼Œå½“ç¬¬ä¸€æ¬¡è¿è¡Œcmakeä¹‹åï¼Œæˆ‘ä»¬ä¿®æ”¹äº†CMakeLists.txtå¹¶ä¸”å†æ¬¡è¿è¡ŒCMakeï¼Œæ­¤æ—¶æœ‰å¯èƒ½æœ‰ä¸€äº›é…ç½®é¡¹ç­‰æ˜¯ä¸èµ·ä½œç”¨çš„ï¼ˆæœ‰äº›æ˜¯èµ·ä½œç”¨ï¼‰ï¼Œå› ä¸ºä»–ä»¬ç¼“å­˜åœ¨CMakeCache.txtï¼Œè€Œæ¯æ¬¡è¿è¡Œcmakeçš„æ—¶å€™æ˜¯ä¸ä¼šåˆ é™¤CMakeCache.txtåå†ç”Ÿæˆä¸€ä»½çš„ï¼Œè€Œæ˜¯æ ¹æ®cmakeè‡ªå·±çš„åŸåˆ™ä¼˜å…ˆè¯»å–CMakeCache.txtä¸­çš„é…ç½®é¡¹ã€‚</p>

<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ é™¤CMakeCache.txtæ–‡ä»¶ç„¶åå†è¿è¡Œcmakeæ¥ç”Ÿæˆæ–°çš„ä¸€ä»½CMakeCache.txtã€‚</p>

<p>å¦‚æœåªæ˜¯ä¿®æ”¹æŸä¸ªé…ç½®ï¼Œé‚£ä¹ˆä¹Ÿå¯ä»¥ç›´æ¥ä¿®æ”¹CMakeCache.txtã€‚</p>

<h4 id="cmakefiles">CMakeFiles/</h4>

<p>è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹æ”¾äº†ä¸€å †ä¸œè¥¿ï¼Œä¸­é—´äº§ç‰©ã€‚</p>

<h4 id="cmake_installcmake">cmake_install.cmake</h4>

<p>çœ‹åå­—å°±çŸ¥é“å®ƒæ˜¯æŒ‡å®šå®‰è£…æ–‡ä»¶çš„ä¿¡æ¯ã€‚</p>

<h4 id="cmakeliststxt">CMakeLists.txt</h4>

<p>å¦‚<code class="highlighter-rouge">cmake å’Œ make æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Ÿ</code>æ‰€è¯´ï¼Œæ˜¯cmakeä½¿ç”¨çš„é…ç½®æ–‡ä»¶ï¼Œæ¯ä¸ªåŒ…å«æºæ–‡ä»¶ï¼ˆä¸ä»…ä»…æ˜¯æºæ–‡ä»¶ï¼‰éƒ½éœ€è¦åŒ…å«ä¸€ä¸ªCMakeLists.txtæ–‡ä»¶</p>

<h4 id="makefile">Makefile</h4>

<p>å¦‚<code class="highlighter-rouge">cmake å’Œ make æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Ÿ</code>æ‰€è¯´ï¼Œè¿™æ˜¯makeéœ€è¦ç”¨çš„é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­å‘½ä»¤ä»€ä¹ˆçš„çœ‹ä¸€ä¸‹å¤§æ¦‚äº†è§£å°±å¥½ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¸éœ€è¦æ‰‹åŠ¨ç¼–è¾‘å®ƒã€‚</p>

<h3 id="é…ç½®æ–‡ä»¶ä¸­">é…ç½®æ–‡ä»¶ä¸­</h3>

<p>è®©æˆ‘ä»¬æ¥å¥½å¥½çœ‹çœ‹é…ç½®æ–‡ä»¶</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test02# cat CMakeLists.txt 
CMAKE_MINIMUM_REQUIRED (VERSION 2.6)
PROJECT (HELLOWORLD)
MESSAGE (STATUS "this is BINARY dir " ${HELLOWORLD_BINARY_DIR})
MESSAGE (STATUS "this is SOURCE dir " ${HELLOWORLD_SOURCE_DIR})
ADD_EXECUTABLE (helloworld helloworld.cpp)
</code></pre></div></div>

<h4 id="cmake_minimum_required-éœ€è¦çš„cmakeæœ€å°ç‰ˆæœ¬">cmake_minimum_required éœ€è¦çš„cmakeæœ€å°ç‰ˆæœ¬</h4>

<p>å¦‚æœå½“å‰ç³»ç»Ÿçš„cmakeç‰ˆæœ¬ä½äºè¿™ä¸ªç‰ˆæœ¬ï¼Œé‚£ä¹ˆå°†ä¼šç›´æ¥é€€å‡ºã€‚</p>

<h4 id="message-æ‰“å°æ¶ˆæ¯">message æ‰“å°æ¶ˆæ¯</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MESSAGE([SEND_ERROR | STATUS | FATAL_ERROR] "message to display" ...)
</code></pre></div></div>

<p>è¿™ä¸ªæŒ‡ä»¤ç”¨äºå‘ç»ˆç«¯è¾“å‡ºç”¨æˆ·å®šä¹‰çš„ä¿¡æ¯ï¼ŒåŒ…å«äº†ä¸‰ç§ç±»å‹:</p>
<ul>
  <li>SEND_ERRORï¼Œäº§ç”Ÿé”™è¯¯ï¼Œç”Ÿæˆè¿‡ç¨‹è¢«è·³è¿‡ã€‚</li>
  <li>SATUSï¼Œè¾“å‡ºå‰ç¼€ä¸º <code class="highlighter-rouge">â€”-</code>çš„ä¿¡æ¯ã€‚</li>
  <li>FATAL_ERRORï¼Œç«‹å³ç»ˆæ­¢æ‰€æœ‰ cmake è¿‡ç¨‹.</li>
</ul>

<p>åœ¨è¿™é‡Œä½¿ç”¨çš„æ˜¯ STATUS ä¿¡æ¯è¾“å‡ºï¼Œæ¼”ç¤ºäº†ç”± PROJECT æŒ‡ä»¤å®šä¹‰çš„ä¸¤ä¸ªéšå¼å˜<code class="highlighter-rouge">HELLOWORLD_SOURCE_DIR</code>å’Œ <code class="highlighter-rouge">HELLOWORLD_SOURCE_DIR</code>ã€‚</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MESSAGE (STATUS "this is BINARY dir " ${HELLOWORLD_BINARY_DIR})
MESSAGE (STATUS "this is SOURCE dir " ${HELLOWORLD_SOURCE_DIR})
</code></pre></div></div>

<p>åœ¨cmakeçš„æ—¶å€™å¯ä»¥çœ‹åˆ°å¯¹åº”è¾“å‡ºçš„æ¶ˆæ¯</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test02# cmake .
...
-- this is BINARY dir /tmp/c/2019-09-12-cmaketest/test02
-- this is SOURCE dir /tmp/c/2019-09-12-cmaketest/test02
...
</code></pre></div></div>

<h4 id="project-é¡¹ç›®åç§°">project é¡¹ç›®åç§°</h4>

<p>ä½ å¯ä»¥ç”¨è¿™ä¸ªæŒ‡ä»¤å®šä¹‰å·¥ç¨‹åç§°ï¼Œå¹¶å¯æŒ‡å®šå·¥ç¨‹æ”¯æŒçš„è¯­è¨€ï¼Œæ”¯æŒçš„è¯­è¨€åˆ—è¡¨æ˜¯å¯ä»¥å¿½ç•¥çš„ã€‚ï¼ˆå½“æˆ‘å‘ç°å®ƒè¿˜æ”¯æŒJavaçš„æ—¶å€™ï¼Œæˆ‘çš„å†…å¿ƒæ˜¯æ‹’ç»çš„ï¼Œå› ä¸ºmavenå¾ˆå¥½ç”¨ :) ï¼‰</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PROJECT(projectname [CXX] [C] [Java])
</code></pre></div></div>

<p>é»˜è®¤æƒ…å†µè¡¨ç¤ºæ”¯æŒæ‰€æœ‰è¯­è¨€ã€‚è¿™ä¸ªæŒ‡ä»¤éšå¼çš„å®šä¹‰äº†ä¸¤ä¸ªcmakeå˜é‡: <code class="highlighter-rouge">&lt;projectname&gt;_BINARY_DIR</code> ä»¥åŠ<code class="highlighter-rouge">&lt;projectname&gt;_SOURCE_DIR</code>ï¼Œè¿™é‡Œå°±æ˜¯ <code class="highlighter-rouge">HELLOWORLD_BINARY_DIR</code> å’Œ <code class="highlighter-rouge">HELLOWORLD_SOURCE_DIR</code>ï¼Œå› ä¸ºé‡‡ç”¨çš„æ˜¯å†…éƒ¨æ„å»ºï¼Œä¸¤ä¸ªå˜é‡ç›®å‰æŒ‡çš„éƒ½æ˜¯å·¥ç¨‹æ‰€åœ¨è·¯å¾„<code class="highlighter-rouge">/tmp/c/2019-09-12-cmaketest/test02</code>ï¼Œæ‰€ä»¥ä¸Šé¢cmakeçš„æ—¶å€™æ‰“å°çš„éƒ½æ˜¯è¿™ä¸ªè·¯å¾„ã€‚åé¢æˆ‘ä»¬ä¼šè®²åˆ°å¤–éƒ¨æ„å»ºï¼Œä¸¤è€…æ‰€æŒ‡ä»£çš„å†…å®¹ä¼šæœ‰æ‰€ä¸åŒã€‚</p>

<p>åŒæ—¶cmakeç³»ç»Ÿä¹Ÿå¸®åŠ©æˆ‘ä»¬é¢„å®šä¹‰äº† <code class="highlighter-rouge">PROJECT_BINARY_DIR</code> å’Œ <code class="highlighter-rouge">PROJECT_SOURCE_DIR</code> å˜é‡ï¼Œä»–ä»¬çš„å€¼åˆ†åˆ«è·Ÿ <code class="highlighter-rouge">HELLO_BINARY_DIR</code> ä¸ <code class="highlighter-rouge">HELLO_SOURCE_DIR</code> ä¸€è‡´ã€‚</p>

<p>ä¸ºäº†ç»Ÿä¸€èµ·è§ï¼Œå»ºè®®ä»¥åç›´æ¥ä½¿ç”¨ <code class="highlighter-rouge">PROJECT_BINARY_DIR</code>ï¼Œ<code class="highlighter-rouge">PROJECT_SOURCE_DIR</code>ï¼Œå³ä½¿ä¿®æ”¹äº†å·¥ç¨‹åç§°ï¼Œä¹Ÿä¸ä¼šå½±å“è¿™ä¸¤ä¸ªå˜é‡ã€‚å¦‚æœä½¿ç”¨äº† <code class="highlighter-rouge">&lt;projectname&gt;_SOURCE_DIR</code>ï¼Œä¿®æ”¹å·¥ç¨‹åç§°åï¼Œéœ€è¦åŒæ—¶ä¿®æ”¹è¿™äº›å˜é‡ã€‚</p>

<h4 id="add_executable-ç”Ÿæˆå¯æ‰§è¡Œçš„æ–‡ä»¶">add_executable ç”Ÿæˆå¯æ‰§è¡Œçš„æ–‡ä»¶</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ADD_EXECUTABLE (helloworld hellworld.cpp)
</code></pre></div></div>

<p>å®šä¹‰äº†è¿™ä¸ªå·¥ç¨‹ä¼šç”Ÿæˆä¸€ä¸ªæ–‡ä»¶åä¸º helloworld çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œç›¸å…³çš„æºæ–‡ä»¶æ˜¯hellworld.cppã€‚</p>

<h4 id="åŸºæœ¬è¯­æ³•è§„åˆ™">åŸºæœ¬è¯­æ³•è§„åˆ™</h4>

<ul>
  <li>1ï¼Œå˜é‡ä½¿ç”¨${}æ–¹å¼å–å€¼ï¼Œä½†æ˜¯åœ¨IFæ§åˆ¶è¯­å¥ä¸­æ˜¯ç›´æ¥ä½¿ç”¨å˜é‡å</li>
</ul>

<p>å¦‚å‰é¢æƒ³å–${HELLOWORLD_BINARY_DIR}çš„å€¼ï¼Œå¦‚ä¸‹</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MESSAGE (STATUS "this is BINARY dir " ${HELLOWORLD_BINARY_DIR})
</code></pre></div></div>

<ul>
  <li>2ï¼ŒæŒ‡ä»¤(å‚æ•° 1 å‚æ•° 2â€¦)</li>
</ul>

<p>å‚æ•°ä½¿ç”¨æ‹¬å¼§æ‹¬èµ·ï¼Œå‚æ•°ä¹‹é—´ä½¿ç”¨ç©ºæ ¼æˆ–åˆ†å·åˆ†å¼€ã€‚ ä»¥ä¸Šé¢çš„ADD_EXECUTABLEæŒ‡ä»¤ä¸ºä¾‹ï¼Œå¦‚æœå­˜åœ¨å¦å¤–ä¸€ä¸ª func.cpp æºæ–‡ä»¶ï¼Œå°±è¦å†™æˆï¼š</p>

<p>ä»¥ç©ºæ ¼åˆ†å‰²çš„å½¢å¼</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ADD_EXECUTABLE(hello hellworld.cpp func.cpp)
</code></pre></div></div>
<p>æˆ–è€… ä»¥åˆ†å·åˆ†å‰²çš„å½¢å¼</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ADD_EXECUTABLE(hello hellworld.cpp;func.cpp) 
</code></pre></div></div>

<ul>
  <li>3ï¼ŒæŒ‡ä»¤æ˜¯å¤§å°å†™æ— å…³çš„ï¼Œå‚æ•°å’Œå˜é‡æ˜¯å¤§å°å†™ç›¸å…³çš„ã€‚ä½†æ¨èä½ å…¨éƒ¨ä½¿ç”¨å¤§å†™æŒ‡ä»¤ã€‚</li>
</ul>

<h2 id="å†…éƒ¨æ„å»ºå’Œå¤–éƒ¨æ„å»º">å†…éƒ¨æ„å»ºå’Œå¤–éƒ¨æ„å»º</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test02# tree -F -L 1
.
â”œâ”€â”€ CMakeCache.txt
â”œâ”€â”€ CMakeFiles/
â”œâ”€â”€ cmake_install.cmake
â”œâ”€â”€ CMakeLists.txt
â”œâ”€â”€ helloworld*           å¯æ‰§è¡Œæ–‡ä»¶
â”œâ”€â”€ helloworld.cpp        æºæ–‡ä»¶
â””â”€â”€ Makefile

1 directory, 6 files
</code></pre></div></div>

<p>åœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ï¼Œç”Ÿæˆçš„ä¸€å †ä¸­é—´æ–‡ä»¶å’Œæºæ–‡ä»¶ï¼ˆhelloworld.cppå’ŒCMakeLists.txtï¼‰æ··åœ¨ä¸€èµ·ï¼Œè¿™ä¸ªå°±å¾ˆè®¨åŒäº†ï¼Œæ¯”å¦‚æˆ‘ä»¬åŒæ­¥åˆ°ä»£ç åº“ä¸­çš„ä»£ç ä¸€èˆ¬ä¸ä¼šåŒ…å«è¿™äº›ä¸­é—´æ–‡ä»¶ï¼Œè¦æ˜¯ä¸€ä¸ªä¸€ä¸ªå»é™åˆ¶ï¼Œé‚£å¤Ÿç´¯çš„ã€‚</p>

<p>ä¹‹å‰å†™è¿‡javaä½¿ç”¨mavenæ¥æ„å»ºçš„å°±çŸ¥é“ï¼Œmavenæ˜¯å°†æ‰€æœ‰çš„çš„ä¸­é—´æ–‡ä»¶æ”¾åˆ°targetç›®å½•ä¸‹ï¼Œæ¯æ¬¡ä½¿ç”¨<code class="highlighter-rouge">mvn clean</code>å°±ä¼šåˆ é™¤è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰ä¸­é—´æ–‡ä»¶ï¼Œè¿™æ ·æ—¢æ²¡æœ‰å’Œæºç æ··åœ¨ä¸€èµ·ï¼Œä¹Ÿè®©ç®¡ç†ä¸­é—´æ–‡ä»¶å˜å¾—å®¹æ˜“ã€‚</p>

<p>åœ¨cmakeä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code class="highlighter-rouge">make clean</code>æ¥æ¸…é™¤æ„å»ºç»“æœï¼ˆåªæŠŠå¯æ‰§è¡Œæ–‡ä»¶åˆ äº†ï¼‰ï¼Œä½†æ˜¯cmakeä¸æ”¯æŒ<code class="highlighter-rouge">make distclean</code>ã€‚å› ä¸º CMakeLists.txt å¯ä»¥æ‰§è¡Œè„šæœ¬å¹¶é€šè¿‡è„šæœ¬ç”Ÿæˆä¸€äº›ä¸´æ—¶æ–‡ä»¶ï¼Œä½†æ˜¯å´æ²¡æœ‰åŠæ³•æ¥è·Ÿè¸ªè¿™äº›ä¸´æ—¶æ–‡ä»¶åˆ°åº•æ˜¯å“ªäº›ï¼Œå› æ­¤ï¼Œæ²¡æœ‰åŠæ³•æä¾›ä¸€ä¸ªå¯é çš„<code class="highlighter-rouge">make distclean</code>æ–¹æ¡ˆï¼Œæ— æ³•åˆ é™¤å…¶å®ƒä¸€äº›ä¸­é—´æ–‡ä»¶ã€‚</p>

<blockquote>
  <p>Some build trees created with GNU autotools have a â€œmake distcleanâ€ target that cleans the build and also removes Makefiles and other parts of the generated build system. CMake does not generate a â€œmake distcleanâ€ target because CMakeLists.txt files can run scripts and arbitrary commands; CMake has no way of tracking exactly which files are generated as part of runningCMake. Providing a distclean target would give users the false impression that it would work as expected. (CMake does generate a â€œmake cleanâ€ target to remove files generated by the compiler and linker.)</p>

  <p>A â€œmake distcleanâ€ target is only necessary if the user performs an in-source build. CMake supports in-source builds, but we strongly encourage users to adopt the notion of an out-of-source build. Using a build tree that is separate from the source tree will prevent CMake from generating any files in the source tree. Because CMake does not change the source tree, there is no need for a distclean target. One can start a fresh build by deleting the build tree or creating a separate build tree. 
â€“ cmakeå®˜æ–¹</p>
</blockquote>

<p>åŒæ—¶ï¼Œè¿˜æœ‰å¦å¤–ä¸€ä¸ªéå¸¸é‡è¦çš„æç¤ºï¼Œå°±æ˜¯ï¼šæˆ‘ä»¬åˆšæ‰è¿›è¡Œçš„æ˜¯å†…éƒ¨æ„å»º(in-source build)ï¼Œè€Œ cmake å¼ºçƒˆæ¨èçš„æ˜¯å¤–éƒ¨æ„å»º(out-of-source build)ã€‚ å°±æ˜¯æŠŠé‚£ä¸€å †ä¸­é—´æ–‡ä»¶æ”¾åˆ°ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹ä¾¿äºç®¡ç†ã€‚</p>

<p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªbuildæ–‡ä»¶å¤¹ï¼ˆè‡³äºä¸ºä»€ä¹ˆå«buildï¼Œå’Œjavaæ˜¯targetä¸€æ ·å§ï¼Œçº¦å®šä¿—æˆäº†å§ã€‚çº¦å®šä¼˜äºé…ç½®ï¼Œæˆ‘å–œæ¬¢è¿™å¥è¯ï¼‰ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­è¿›è¡Œæ„å»ºï¼ˆè€Œä¸æ˜¯åœ¨æºä»£ç ç›®å½•ä¸‹ï¼‰ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„ä¸­é—´æ–‡ä»¶éƒ½ä¼šåœ¨è¿™ä¸ªbuildeæ–‡ä»¶å¤¹ä¸‹ã€‚</p>

<p>å…³äºbuildæ–‡ä»¶å¤¹ï¼Œæœ‰ä¸¤ç§å­˜æ”¾æ–¹å¼ï¼Œç¬¬ä¸€ç§æ˜¯æŠŠbuildæ–‡ä»¶å¤¹æ”¾åœ¨é¡¹ç›®çš„ç›®å½•ä¸‹ï¼Œå¦‚ä¸‹æ‰€ç¤º</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dir/
  project01/
    helloworld.cpp
    CMakeLists.txt
    build/
  project02/
    helloworld.cpp
    CMakeLists.txt
    build/
</code></pre></div></div>

<p>ç¬¬äºŒç§æ˜¯åœ¨é¡¹ç›®çš„ç›®å½•å¤–ï¼Œè¿™ç§æƒ…å†µä¸‹æ‰€æœ‰é¡¹ç›®å…±ç”¨ä¸€ä¸ªbuildç›®å½•ï¼Œå¦‚ä¸‹æ‰€ç¤º</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dir/
  build/
  project01/
    helloworld.cpp
    CMakeLists.txt
  project02/
    helloworld.cpp
    CMakeLists.txt
</code></pre></div></div>

<p>å½“ç„¶ä¸ä¸€å®šéè¦å…±ç”¨ä¸€ä¸ªbuildç›®å½•ï¼Œä½ å¯ä»¥å–ä¸åŒçš„åå­—ï¼Œå¦‚ä¸‹æ‰€ç¤º</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dir/
  build01/
  build02/
  project01/
    helloworld.cpp
    CMakeLists.txt
  project02/
    helloworld.cpp
    CMakeLists.txt
</code></pre></div></div>

<p>ä¸€èˆ¬æˆ‘ç”¨çš„ç¬¬äºŒç§ã€‚ç°åœ¨æˆ‘ä»¬ä½¿ç”¨ç¬¬ä¸€ç§æ¥æ¼”ç¤ºä¸€ä¸‹ï¼Œå› ä¸ºè¿™ç§æ¼”ç¤ºçœ‹çš„æ¯”è¾ƒæ¸…æ¥šã€‚å…¶å®ƒçš„éƒ½æ˜¯ä¸€ä¸ªæ„æ€ã€‚</p>

<p>å½“å‰æ‰€åœ¨è·¯å¾„</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test03# pwd
/tmp/c/2019-09-12-cmaketest/test03
</code></pre></div></div>

<p>å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶/æ–‡ä»¶å¤¹</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/test03# tree -F
.
â”œâ”€â”€ build/
â”œâ”€â”€ CMakeLists.txt
â””â”€â”€ helloworld.cpp

1 directory, 2 files
</code></pre></div></div>

<p>CMakeLists.txtæ–‡ä»¶å’Œhelloworldæ–‡ä»¶å’Œtest02æ˜¯ä¸€æ ·çš„ï¼Œæ–°å»ºäº†ä¸€ä¸ªbuildç›®å½•ã€‚</p>

<p>ç°åœ¨è®©æˆ‘ä»¬è¿›å…¥buildç›®å½•è¿›è¡Œç¼–è¯‘</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test03# cd build/

test03/build# cmake ..
-- The C compiler identification is GNU 5.4.0
-- The CXX compiler identification is GNU 5.4.0
-- Check for working C compiler: /usr/bin/cc
-- Check for working C compiler: /usr/bin/cc -- works
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - done
-- Detecting C compile features
-- Detecting C compile features - done
-- Check for working CXX compiler: /usr/bin/c++
-- Check for working CXX compiler: /usr/bin/c++ -- works
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - done
-- Detecting CXX compile features
-- Detecting CXX compile features - done
-- this is BINARY dir /tmp/c/2019-09-12-cmaketest/test03/build
-- this is SOURCE dir /tmp/c/2019-09-12-cmaketest/test03
-- Configuring done
-- Generating done
-- Build files have been written to: /tmp/c/2019-09-12-cmaketest/test03/build
</code></pre></div></div>

<p>å¯ä»¥çœ‹åˆ°æ­¤æ—¶ä¸¤ä¸ªè·¯å¾„ä¹‹é—´çš„åŒºåˆ«äº†ï¼Œæºä»£ç ç›®å½•ä»ç„¶æ˜¯<code class="highlighter-rouge">/tmp/c/2019-09-12-cmaketest/test03</code>ï¼Œè€Œæ„å»ºç›®å½•æ˜¯<code class="highlighter-rouge">/tmp/c/2019-09-12-cmaketest/test03/build</code></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-- this is BINARY dir /tmp/c/2019-09-12-cmaketest/test03/build
-- this is SOURCE dir /tmp/c/2019-09-12-cmaketest/test03
</code></pre></div></div>

<p>ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶å¹¶è¿è¡Œ</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test03/build# make
Scanning dependencies of target helloworld
[ 50%] Building CXX object CMakeFiles/helloworld.dir/helloworld.cpp.o
[100%] Linking CXX executable helloworld
[100%] Built target helloworld

root@iZbp1ccq9xttkzab5d3fc9Z:/tmp/c/2019-09-12-cmaketest/test03/build# ./helloworld 
hello world
</code></pre></div></div>

<p>è¿”å›ä¸Šä¸€å±‚ç›®å½•çœ‹çœ‹</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>test03/build# cd ..

root@iZbp1ccq9xttkzab5d3fc9Z:/tmp/c/2019-09-12-cmaketest/test03# tree -F -L 2
.
â”œâ”€â”€ build/
â”‚Â Â  â”œâ”€â”€ CMakeCache.txt
â”‚Â Â  â”œâ”€â”€ CMakeFiles/
â”‚Â Â  â”œâ”€â”€ cmake_install.cmake
â”‚Â Â  â”œâ”€â”€ helloworld*
â”‚Â Â  â””â”€â”€ Makefile
â”œâ”€â”€ CMakeLists.txt
â””â”€â”€ helloworld.cpp

2 directories, 6 files
root@iZbp1ccq9xttkzab5d3fc9Z:/tmp/c/2019-09-12-cmaketest/test03# 
</code></pre></div></div>

<p>å¯ä»¥çœ‹åˆ°ç°åœ¨ï¼Œæ‰€æœ‰çš„ä¸­é—´æ–‡ä»¶éƒ½å·²ç»åœ¨buildç›®å½•ä¸­ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦åˆ é™¤æ‰€æœ‰ä¸­é—´æ–‡ä»¶ï¼Œåªéœ€è¦åˆ é™¤buildç›®å½•ä¸‹æ‰€æœ‰çš„æ–‡ä»¶å³å¯ã€‚</p>

<p>æ¨èä½¿ç”¨å¤–éƒ¨æ„å»ºçš„æ–¹å¼ï¼Œå› ä¸ºå½“ä½ çš„æºæ–‡ä»¶ä¸€å¤šï¼Œå†å’Œè¿™äº›ä¸­é—´æ–‡ä»¶å‡‘åœ¨ä¸€èµ·ï¼Œæƒ³åˆ†å¼€éƒ½ä¸å®¹æ˜“å•Šã€‚</p>

<p>å…ˆåˆ°è¿™ï¼Œåç»­çš„ä¸‹æ¬¡å†æ•´ç†ï¼Œæ°é¥­æ°é¥­ã€‚</p>

<h2 id="å‚è€ƒ">å‚è€ƒ</h2>

<ul>
  <li>cmake practice</li>
  <li><a href="https://www.cnblogs.com/liu3yuan/p/6895419.html">ä¸ºä½•è¦ä½¿ç”¨cmakeä¸­æ–‡ç¿»è¯‘å‚è€ƒ</a></li>
  <li><a href="https://cmake.org/cmake/help/latest/manual/cmake-variables.7.html#variables-that-change-behavior">cmakeå˜é‡</a></li>
</ul>

:ET